%*** TRZ020.RDL
%***
%**  Copyright (c) 1998, Mincom Pty Ltd, Brisbane 4120, Australia.
%*** All rights reserved.
%***
%*** Revision History ***
%*** 26-Sep-13 wenhuei	  SC0000004384685
%*** .................... Change WHERE    (DATE-GMT >= %IFRDTE%)
%*** .................... to WHERE    (DATE-GMT >= SPACES)
%*** .................... so report able to generated even no data matching
%*** 12-Sep-12 a9is6175   MO164 (Version 0001)
%*** .................... Reset version number to 0001 for E8 upgrade. 
%*** 21-Jun-05 bs2873     SC1140705
%*** .................... Fix. In CUSR var use the EMPID with the leading
%** ..................... zeros otherwise nothing is selected.
%*** 07-Dec-98 Autogen    Fix for MIMS 4.3.
%*** .................... Generated by Version 003 of GENAUDIT.MAC.
%*** 16-Apr-98 EFredeluces  W804060032
%*** .....................  To include the employee surname and initials.
%***
%PROGRAM-ID
       TRZ020
%AUTHOR
       Mincom PTY LTD
%NARRATIVE
      **  This program produces the audit records for MSF020
%VERSION
       0001
%MODULE
       3001
%FILES
        MFILE = MSF034
        LFILE = MSF810
        RFILE = TRZ020A
%SELECTION
%***   20130926 LWH
%***   WHERE    (DATE-GMT >= %IFRDTE%)
	   WHERE    (DATE-GMT >= SPACES)
       STOPIF   (%ITODTE% <> SPACES, -
                 DATE-GMT  > %ITODTE%)
%ROUTINES
       MSSDAT
       MSSCNV
%AUDITING-DATASETS
       MSF020
%REQUEST-PARAMETERS
       IMODF    PIC (X(1))    TEXT 'Modified fields only   : '
       IFRDTE   PIC (X(8))    TEXT 'From date              : '
       ITODTE   PIC (X(8))    TEXT 'To date                : '
       ITYP     PIC (X(1))    TEXT 'Modify type a/c/m/d    : '
       IUSER    PIC (X(10))   TEXT 'User id                : '
%TITLE
'AUDIT TRAIL REPORT - SECURITY FILE (MSF020)'
%PAGE HEADING
'TYPE     KEY                                            DATE       TIME   USER ID     EMPLOYEE NAME                    PROGRAM'
%DETAIL TEST-PAGE(14)
<IF CTYP = 'Y' AND CUSR = 'Y' AND CDTE = 'Y'>
   <IF KEYB1 = SPACES>

{ATYP   } {KEYA1     }                                 {ADTE    } {ATIM  } {AUSER   }  {ENAME                         } {APROG }
   <ELSE>

{ATYP   } {KEYB1     }                                 {ADTE    } {ATIM  } {AUSER   }  {ENAME                         } {APROG }

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C11 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN1         } {FD1                    } {F1B1  }
                                                   {F1A1  }
         <ELSE>
          {FN1         } {FD1                    } {F1Z1  }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN1         } {FD1                    } {F1B1  }
                                                   {F1A1  }
      <ELSE>
          {FN1         } {FD1                    } {F1Z1  }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C21 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN2         } {FD2                    } {F2B1      }
                                                   {F2A1      }
         <ELSE>
          {FN2         } {FD2                    } {F2Z1      }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN2         } {FD2                    } {F2B1      }
                                                   {F2A1      }
      <ELSE>
          {FN2         } {FD2                    } {F2Z1      }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C31 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN3         } {FD3                    } {F3B1  }
                                                   {F3A1  }
         <ELSE>
          {FN3         } {FD3                    } {F3Z1  }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN3         } {FD3                    } {F3B1  }
                                                   {F3A1  }
      <ELSE>
          {FN3         } {FD3                    } {F3Z1  }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C41 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN4         } {FD4                    } {F4B1  }
                                                   {F4A1  }
         <ELSE>
          {FN4         } {FD4                    } {F4Z1  }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN4         } {FD4                    } {F4B1  }
                                                   {F4A1  }
      <ELSE>
          {FN4         } {FD4                    } {F4Z1  }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C51 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN5         } {FD5                    } {F5B1      }
                                                   {F5A1      }
         <ELSE>
          {FN5         } {FD5                    } {F5Z1      }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN5         } {FD5                    } {F5B1      }
                                                   {F5A1      }
      <ELSE>
          {FN5         } {FD5                    } {F5Z1      }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C61 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN6         } {FD6                    } {F6B1      }
                                                   {F6A1      }
         <ELSE>
          {FN6         } {FD6                    } {F6Z1      }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN6         } {FD6                    } {F6B1      }
                                                   {F6A1      }
      <ELSE>
          {FN6         } {FD6                    } {F6Z1      }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C71 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN7         } {FD7                    } {F7B1  }
                                                   {F7A1  }
         <ELSE>
          {FN7         } {FD7                    } {F7Z1  }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN7         } {FD7                    } {F7B1  }
                                                   {F7A1  }
      <ELSE>
          {FN7         } {FD7                    } {F7Z1  }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C81 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN8         } {FD8                    } {F8B1    }
                                                   {F8A1    }
         <ELSE>
          {FN8         } {FD8                    } {F8Z1    }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN8         } {FD8                    } {F8B1    }
                                                   {F8A1    }
      <ELSE>
          {FN8         } {FD8                    } {F8Z1    }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C91 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN9         } {FD9                    } {F9B1    }
                                                   {F9A1    }
         <ELSE>
          {FN9         } {FD9                    } {F9Z1    }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN9         } {FD9                    } {F9B1    }
                                                   {F9A1    }
      <ELSE>
          {FN9         } {FD9                    } {F9Z1    }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C101 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN10        } {FD10                   } {F10B1   }
                                                   {F10A1   }
         <ELSE>
          {FN10        } {FD10                   } {F10Z1   }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN10        } {FD10                   } {F10B1   }
                                                   {F10A1   }
      <ELSE>
          {FN10        } {FD10                   } {F10Z1   }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C111 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN11        } {FD11                   } {F11B1 }
                                                   {F11A1 }
         <ELSE>
          {FN11        } {FD11                   } {F11Z1 }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN11        } {FD11                   } {F11B1 }
                                                   {F11A1 }
      <ELSE>
          {FN11        } {FD11                   } {F11Z1 }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C121 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN12        } {FD12                   } {F12B1     }
                                                   {F12A1     }
         <ELSE>
          {FN12        } {FD12                   } {F12Z1     }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN12        } {FD12                   } {F12B1     }
                                                   {F12A1     }
      <ELSE>
          {FN12        } {FD12                   } {F12Z1     }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C131 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN13        } {FD13                   } {F13B1   }
                                                   {F13A1   }
         <ELSE>
          {FN13        } {FD13                   } {F13Z1   }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN13        } {FD13                   } {F13B1   }
                                                   {F13A1   }
      <ELSE>
          {FN13        } {FD13                   } {F13Z1   }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C141 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN14        } {FD14                   } {F14B1     }
                                                   {F14A1     }
         <ELSE>
          {FN14        } {FD14                   } {F14Z1     }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN14        } {FD14                   } {F14B1     }
                                                   {F14A1     }
      <ELSE>
          {FN14        } {FD14                   } {F14Z1     }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C151 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN15        } {FD15                   } {F15B1     }
                                                   {F15A1     }
         <ELSE>
          {FN15        } {FD15                   } {F15Z1     }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN15        } {FD15                   } {F15B1     }
                                                   {F15A1     }
      <ELSE>
          {FN15        } {FD15                   } {F15Z1     }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C161 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN16        } {FD16                   } {F16B1                                                                        }
                                                   {F16A1                                                                        }
         <ELSE>
          {FN16        } {FD16                   } {F16Z1                                                                        }
         <ENDIF>
      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN16        } {FD16                   } {F16B1                                                                        }
                                                   {F16A1                                                                        }
      <ELSE>
          {FN16        } {FD16                   } {F16Z1                                                                        }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C171 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN17        } {FD17                   } {F17B1     }
                                                   {F17A1     }
         <ELSE>
          {FN17        } {FD17                   } {F17Z1     }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN17        } {FD17                   } {F17B1     }
                                                   {F17A1     }
      <ELSE>
          {FN17        } {FD17                   } {F17Z1     }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C181 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN18        } {FD18                   } {F18B1     }
                                                   {F18A1     }
         <ELSE>
          {FN18        } {FD18                   } {F18Z1     }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN18        } {FD18                   } {F18B1     }
                                                   {F18A1     }
      <ELSE>
          {FN18        } {FD18                   } {F18Z1     }
      <ENDIF>

   <ENDIF>
<ENDIF>
%REPORT-SUMMARY



                                                 '*** END OF REPORT ***'

%VARIABLES
        XDAT  = WX-TODAYS-DATE
%* get yesterday
      YDATT = DATE2 of MSSDAT -
               where (OPTION    =  '1',   -
                      DATE1     =  XDAT,  -
                      DAYS      = -1)
%*
%* setup if date range to default
%* i.e. if no input parameter for 'to' date, use yesterday's date (YDATT)
      CDATT = choose (YDATT IF (%ITODTE% = '        '), -
                      YDATT IF (%ITODTE% = '00000000'), -
                      %ITODTE%) I-PIC (9(8))
%* i.e. if no input parameter for 'from' date, use yesterday's date (YDATT)
      CDATF = choose (YDATT IF (%IFRDTE% = '        '), -
                      YDATT IF (%IFRDTE% = '00000000'), -
                      %IFRDTE%) I-PIC (9(8))
%* set a variable if required
%* if date on MSF034 file is with the 'from' and 'to' dates,
%* then set print parameter to 'Y'
      CDTE  = choose ('Y' IF (DATE-GMT >= CDATF AND DATE-GMT <= CDATT), -
                      'N')
%* get employee name
       EMPF   = USER-ID
       EMP    = substr (EMPF,2,5)       D-PIC (X(5))
       EMPID  = catenate ('00000',EMP)  D-PIC (X(10))
       SNAME  = SURNAME OF MSF810 - 
                     WHERE (EMPLOYEE-ID = EMPID)
       FNAME  = FIRST-NAME  VIA (SNAME)
       NAME   = catenate (SNAME,' ',FNAME)
       ENAME  = OUT-STRING OF MSSCNV -
                     WHERE (OPTION     = 'P', -
                            INP-STRING = NAME)
       FN1    = 'ENTRY-TYPE'                CONSTANT
       FD1    = 'MSF020 entry type P or S'  CONSTANT
       FN2    = 'ENTITY'                    CONSTANT
       FD2    = 'A program name or userid.' CONSTANT
       FN3    = 'DSTRCT-CODE'               CONSTANT
       FD3    = 'District identifier code'  CONSTANT
       FN4    = 'DEFAULT-FLAG'              CONSTANT
       FD4    = 'Default district indicato' CONSTANT
       FN5    = 'PASS-WORD'                 CONSTANT
       FD5    = 'Password for a userid.'    CONSTANT
       FN6    = 'DEFAULT-MENU'              CONSTANT
       FD6    = 'Menu to display initially' CONSTANT
       FN7    = 'SECURITY-ACCES'            CONSTANT
       FD7    = 'Create/delete profile acc' CONSTANT
       FN8    = 'LAST-ACC-DATE'             CONSTANT
       FD8    = 'Date of last access to us' CONSTANT
       FN9    = 'PSW-UPD-DATE'              CONSTANT
       FD9    = 'Last time password update' CONSTANT
       FN10   = 'LAST-MOD-DATE'             CONSTANT
       FD10   = 'Last Modification Date'    CONSTANT
       FN11   = 'LAST-MOD-TIME'             CONSTANT
       FD11   = 'Last Modification Time'    CONSTANT
       FN12   = 'LAST-MOD-USER'             CONSTANT
       FD12   = 'Last Modification User Id' CONSTANT
       FN13   = 'CREATION-DATE'             CONSTANT
       FD13   = 'Date record created'       CONSTANT
       FN14   = 'GLOBAL-PROFILE'            CONSTANT
       FD14   = 'Global profile indicator.' CONSTANT
       FN15   = 'EMPLOYEE-ID'               CONSTANT
       FD15   = 'Employee identification c' CONSTANT
       FN16   = 'PROFILE'                   CONSTANT
       FD16   = 'Security profile'          CONSTANT
       FN17   = 'OWNER-ID'                  CONSTANT
       FD17   = 'Owner ID of this Trainng'  CONSTANT
       FN18   = 'OGUI-GLOBAL-PR'            CONSTANT
       FD18   = 'ObjectGUI Global Profile'  CONSTANT
       AUD    = AUDIT-TYPE
       CTYP   = choose ('Y' IF (%ITYP% = SPACES), -
                        'Y' IF (%ITYP% = 'A'), -
                        'Y' IF (%ITYP% = 'C', AUD = 'W'), -
                        'Y' IF (%ITYP% = 'D', AUD = 'D'), -
                        'Y' IF (%ITYP% = 'M', AUD = 'A'), -
                        'Y' IF (%ITYP% = 'M', AUD = 'B'), -
                        'N')
       CUSR   = choose ('Y' IF (%IUSER% = SPACES), -
%*                        'Y' IF (%IUSER% = USER-ID), -
                        'Y' IF (%IUSER% = EMPID), -
                        'N')
       ADTE   = DATE-GMT FORMAT (DATE)
       ATIM   = TIME-GMT FORMAT (TIME)
       AUSER  = USER-ID
       APROG  = PROGRAM-NAME
       ATYP   = choose ('Create' IF (AUD = 'W'), -
                        'Delete' IF (AUD = 'D'), -
                        'Modify')
       KEYB1 = before-value (MSF020, KEY-020)
       KEYA1 = after-value (MSF020, KEY-020)

       C11    = changed (MSF020, ENTRY-TYPE)
       F1B1   = before-value (MSF020, ENTRY-TYPE)
       F1A1   = after-value (MSF020, ENTRY-TYPE)
       F1Z1   = choose (F1B1 IF (ATYP = 'Delete'), -
                        F1A1 IF (ATYP = 'Create'), -
                        SPACES)

       C21    = changed (MSF020, ENTITY)
       F2B1   = before-value (MSF020, ENTITY)
       F2A1   = after-value (MSF020, ENTITY)
       F2Z1   = choose (F2B1 IF (ATYP = 'Delete'), -
                        F2A1 IF (ATYP = 'Create'), -
                        SPACES)

       C31    = changed (MSF020, DSTRCT-CODE)
       F3B1   = before-value (MSF020, DSTRCT-CODE)
       F3A1   = after-value (MSF020, DSTRCT-CODE)
       F3Z1   = choose (F3B1 IF (ATYP = 'Delete'), -
                        F3A1 IF (ATYP = 'Create'), -
                        SPACES)

       C41    = changed (MSF020, DEFAULT-FLAG)
       F4B1   = before-value (MSF020, DEFAULT-FLAG)
       F4A1   = after-value (MSF020, DEFAULT-FLAG)
       F4Z1   = choose (F4B1 IF (ATYP = 'Delete'), -
                        F4A1 IF (ATYP = 'Create'), -
                        SPACES)

       C51    = changed (MSF020, PASS-WORD)
       F5B1   = before-value (MSF020, PASS-WORD)
       F5A1   = after-value (MSF020, PASS-WORD)
       F5Z1   = choose (F5B1 IF (ATYP = 'Delete'), -
                        F5A1 IF (ATYP = 'Create'), -
                        SPACES)

       C61    = changed (MSF020, DEFAULT-MENU)
       F6B1   = before-value (MSF020, DEFAULT-MENU)
       F6A1   = after-value (MSF020, DEFAULT-MENU)
       F6Z1   = choose (F6B1 IF (ATYP = 'Delete'), -
                        F6A1 IF (ATYP = 'Create'), -
                        SPACES)

       C71    = changed (MSF020, SECURITY-ACCESS)
       F7B1   = before-value (MSF020, SECURITY-ACCESS)
       F7A1   = after-value (MSF020, SECURITY-ACCESS)
       F7Z1   = choose (F7B1 IF (ATYP = 'Delete'), -
                        F7A1 IF (ATYP = 'Create'), -
                        SPACES)

       C81    = changed (MSF020, LAST-ACC-DATE)
       F8B1   = before-value (MSF020, LAST-ACC-DATE)
       F8A1   = after-value (MSF020, LAST-ACC-DATE)
       F8Z1   = choose (F8B1 IF (ATYP = 'Delete'), -
                        F8A1 IF (ATYP = 'Create'), -
                        SPACES)

       C91    = changed (MSF020, PSW-UPD-DATE)
       F9B1   = before-value (MSF020, PSW-UPD-DATE)
       F9A1   = after-value (MSF020, PSW-UPD-DATE)
       F9Z1   = choose (F9B1 IF (ATYP = 'Delete'), -
                        F9A1 IF (ATYP = 'Create'), -
                        SPACES)

       C101   = changed (MSF020, LAST-MOD-DATE)
       F10B1  = before-value (MSF020, LAST-MOD-DATE)
       F10A1  = after-value (MSF020, LAST-MOD-DATE)
       F10Z1  = choose (F10B1 IF (ATYP = 'Delete'), -
                        F10A1 IF (ATYP = 'Create'), -
                        SPACES)

       C111   = changed (MSF020, LAST-MOD-TIME)
       F11B1  = before-value (MSF020, LAST-MOD-TIME)
       F11A1  = after-value (MSF020, LAST-MOD-TIME)
       F11Z1  = choose (F11B1 IF (ATYP = 'Delete'), -
                        F11A1 IF (ATYP = 'Create'), -
                        SPACES)

       C121   = changed (MSF020, LAST-MOD-USER)
       F12B1  = before-value (MSF020, LAST-MOD-USER)
       F12A1  = after-value (MSF020, LAST-MOD-USER)
       F12Z1  = choose (F12B1 IF (ATYP = 'Delete'), -
                        F12A1 IF (ATYP = 'Create'), -
                        SPACES)

       C131   = changed (MSF020, CREATION-DATE)
       F13B1  = before-value (MSF020, CREATION-DATE)
       F13A1  = after-value (MSF020, CREATION-DATE)
       F13Z1  = choose (F13B1 IF (ATYP = 'Delete'), -
                        F13A1 IF (ATYP = 'Create'), -
                        SPACES)

       C141   = changed (MSF020, GLOBAL-PROFILE)
       F14B1  = before-value (MSF020, GLOBAL-PROFILE)
       F14A1  = after-value (MSF020, GLOBAL-PROFILE)
       F14Z1  = choose (F14B1 IF (ATYP = 'Delete'), -
                        F14A1 IF (ATYP = 'Create'), -
                        SPACES)

       C151   = changed (MSF020, EMPLOYEE-ID)
       F15B1  = before-value (MSF020, EMPLOYEE-ID)
       F15A1  = after-value (MSF020, EMPLOYEE-ID)
       F15Z1  = choose (F15B1 IF (ATYP = 'Delete'), -
                        F15A1 IF (ATYP = 'Create'), -
                        SPACES)

       C161   = changed (MSF020, PROFILE)
       F16B1  = before-value (MSF020, PROFILE)
       F16A1  = after-value (MSF020, PROFILE)
       F16Z1  = choose (F16B1 IF (ATYP = 'Delete'), -
                        F16A1 IF (ATYP = 'Create'), -
                        SPACES)

       C171   = changed (MSF020, OWNER-ID)
       F17B1  = before-value (MSF020, OWNER-ID)
       F17A1  = after-value (MSF020, OWNER-ID)
       F17Z1  = choose (F17B1 IF (ATYP = 'Delete'), -
                        F17A1 IF (ATYP = 'Create'), -
                        SPACES)

       C181   = changed (MSF020, OGUI-GLOBAL-PROF)
       F18B1  = before-value (MSF020, OGUI-GLOBAL-PROF)
       F18A1  = after-value (MSF020, OGUI-GLOBAL-PROF)
       F18Z1  = choose (F18B1 IF (ATYP = 'Delete'), -
                        F18A1 IF (ATYP = 'Create'), -
                        SPACES)
