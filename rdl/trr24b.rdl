%***  $Id: trr24b.rdl,v5.0 12/03/2012 16:00:00 Exp $
%*** TRR24B.rdl
%***
%*** Revision History ***
%*** 10-Jul-13 D Bof         Version 008 SC4284770 
%***                         Extended stock description has moved from MSF096 to MSF1CC
%***                         MSS1D1 is now used to extract the extended description
%*** 17-Jun-13 Siew Lee      SC4261240 - Version 007
%***                         Remove Reorder Qty and insert MAX-STOCK-LV.
%*** 19-Apr-13 a9nl6176      Only retrieved Global PART-NO.
%*** 10-Apr-13 a9nl6176      Corrected the way to print PART-NO details.
%*** 20-Mar-13 a9nl6176      Modify the way to get MSF110-PART-NO. Delete
%*** .....................   BREAK STOCK-CODE FOOTING. Aligned some fields.
%*** 20-Feb-13 a9ll4261      Modify the Group Class literal to Category ID.
%*** .....................   Add new request param: inventory controller team.
%*** 21-Nov-12 a9nl6176      Deleted variable R, caused error but never used.
%*** 22-Aug-12 Brandon       Upgraded to E8 by Mitrais. Resetting version to 1.
%*** 12-Mar-12 E Fredeluces  SC3909059           (Version 005)
%*** .....................   Retrieve the warehouse id from MSF240 instead
%*** .....................   of MSF170.  Use +WH set-up for 'Recommended
%*** .....................   Order Report Printer' (pos 5&6) to generate
%*** .....................   the report.
%*** 14-Nov-05 E Fredeluces  P05110870
%***                         Fix compilation errors in Ellipse 5.2.3.7.
%*** 29-Oct-02 EFredeluces   Retrieve the Expiry & Effective Date from
%*** .....................   MSF210 instead of MSF170.
%*** 20-Sep-99 DDiolaso      Modified to include the printing of global and
%*** .....................   district stock code commentary
%*** 22-Jun-99 EFredeluces   To fix the problem with stock line not printing.
%*** 10-Jun-99 EFredeluces   W99060289
%*** .....................   To fix the problem of the global mnemonic and
%*** ......................  part number not printing.
%*** 16-Apr-96 Mincom        Replace 'RC' table access with HRGET macro.
%*** 15-NOV-95 Peter Lacey
%*** ...................... Converted from 3.010 to 3.013. Changed field
%*** ...................... MSF190-PRIME-LOCATION to MSF190-BIN-DETAILS.
%*** ...................... Changed MSF210-SUPP-LEAD-TIME to
%*** ...................... MSF210-SUPP-LEAD-TIME-9, it doesn't compile with
%*** ...................... (BWZ) BLANK WHEN ZERO on a alphanumeric field.
%*** 02-AUG-1993 David_Gatward: Fix fpa effective & expiry dates -
%*** ......................     was getting via (dr) s/be via (ropt).
%*** 09-DEC-1992 David_Gatward: Print UN Transport & Hazardous goods codes/desc.
%*** ......................     Print 2 bin locations instead of 1.
%*** 18-NOV-1992 Mary Wachman: Fix stockline.
%*** 03-NOV-1992 Mary Wachman: Version 4. Added Stockline to report 'B'.
%*** ...................... Added 210 Part no's to report 'A'.
%*** 29-SEP-1992 Mary_Wachman: Version 4. Amended report TRR24BA. Moved
%*** ...................... Commentary to print after Stock Qualifiers
%*** ...................... rather than after Order History.
%*** 15-APR-1992 David_Gatward
%*** ...................... Print type of commentary before text eg. GlbSupPC
%*** 06-MAR-1991 David_Gatward
%*** ...................... Remove dynamic printer - print at request printer -
%*** ......................      (Dyn.printer was printing at blank printer ie.
%*** ......................       default - 3.008 does not use blank as default)
%*** 16-DEC-1991 David_Gatward
%*** ...................... Print class/type from MSF170 not MSF100
%*** 08-NOV-1991 David_Gatward
%*** ...................... Uncomment calculated ROP's variables (mss240)
%***
%PROGRAM-ID
       TRR24B
%AUTHOR
       DAVID GATWARD
%NARRATIVE
      **  This program reports on newly created stores recommended orders.
      **  The input parameters are:
      **  - Run number
      **  - A (or range of) specified Inventory Controller code.
      **  - Inventory Controller Team
      **  - Supplier
      **  - Category ID
      **
      **  The report provides a sort sequence of
      **  - Inventory Controller
      **  - Inventory Controller Team
      **  - Supplier Number
      **  - Category ID
      **  - Stock Code and
      **  - Recommended order number (activity counter).
      **
      **  District control file indicators and other values on the
      **  MSF000 'RO' record determine how comprehensive the report
      **  is to be regarding the printing of various details.
      **
%VERSION
       008
%MODULE
       3210
%FILES
        MFILE = MSF240A
        LFILE = MSF000
        LFILE = MSF001
        LFILE = MSF010
        LFILE = MSF062
        LFILE = MSFX96A
        LFILE = MSF100
        LFILE = MSF100
        LFILE = MSF110A
        LFILE = MSF160
        LFILE = MSF170
        LFILE = MSF170A
        LFILE = MSF171
        LFILE = MSF180
        LFILE = MSF200
        LFILE = MSF203
        LFILE = MSF210
        LFILE = MSF220
        LFILE = MSF221B
        LFILE = MSF235
        LFILE = MSF250
        LFILE = MSF254
        LFILE = MSF900
        LFILE = MSF1HB
        LFILE = MSF1CSA
        LFILE = MSF1CC 
        RFILE = TRR24BA
        RFILE = TRR24BB
%ROUTINES
       MSS175
       MSS240
       MSSSOH
       MSS1D1
%SELECTION
%*** Enter selection criteria for MSF240
%*<IF WX-CENTRAL-PURCH = 'Y' AND WX-MULTIDSTRCT = 2>
       WHERE (RO-ACTION-TYPE  = 'S',    -
              RUN-NUMBER      = RUN-NO, -
              EMPLOYEE-ID    >= SPACES)
       REJECTIF (%SUPP-NO%   <> SPACES, SUPPLIER-NO <> %SUPP-NO%)
       REJECTIF (%EMP-ID%    <> SPACES, EMPLOYEE-ID <> %EMP-ID%)
       REJECTIF (%INVT-CNTL-TEAM% <> SPACES, INVT-CNTL-TEAM <> %INVT-CNTL-TEAM%)
       REJECTIF (%GRP-CLASS% <> SPACES, CATEG-ID <> %GRP-CLASS%)
       REJECTIF (DSTRCT-CODE <> %DISTRICT-CODE%)
%ORDER
       EMPLOYEE-ID
       INVT-CNTL-TEAM
       SUPPLIER-NO
       CATEG-ID
       STOCK-CODE
%BREAK-FIELDS
       STOCK-CODE
%REPORT
       A
%REPORT-TITLE
       'STORES RECOMMENDED ORDER REPORT'
%PAGE HEADING
'PLANT SPARES CONTROLLER'{EMPIV} {IVNAME                                 }'Approved by ............ Date....... Run Number:'{RUN-NO}
'Category ID'{GC}      'Has this Item been reviewed using the Spares Criticality Assesment System (SCAS) ?     Yes / No'
%*'SUPPLIER'   {SUP }     {SNAME                       }'GROUP CLASS-'{GC} {GCDESC                                }
%DETAIL ON NEW-PAGE
%*  SC4261240 start (version 007) 
%*'Stock Code:'{STK    }'Rec.Order No.:'AAA         'Part Nos - 210/Dist/Global Prefs  R.O.P.'      {ROPT   } 'Owned SOH'    {SOHO   }
%*'Description *********'              '***'{MMA210} {PARTA210                   }'210 Reorder Qty' {RQTY   }'-Being Picked' {SOHB   }
%* {INAME                                 } {MMB210} {PARTB210                   }'210 Min.Stk.Lvl' {MINS   }'-Dues Out'     {SOHDO  }
'Stock Code:'{STK    }'Rec.Order No.:'AAA         'Part Nos - 210/Dist/Global Prefs        '                'Owned SOH'    {SOHW   }
'Description *********'              '***'{MMA210} {PARTA210                   }'210 Min.Stk.Lvl' {MINW   }'-Being Picked' {SOHB   }
 {INAME                                 } {MMB210} {PARTB210                   }'210 Max.Stk.Lvl' {MAXS   }'-Dues Out'     {SOHDO  }
%* SC4261240 end
 {STKDESC                               } {MMC210} {PARTC210                   }'210 U.O.I.'          {UI} '-Reserved'     {SOHR   }
 {STKDESC                               } {MNEM  } {PARTNO                      } BB'Bypass Str/P'    HXJ  '+Dues in'      {SOHDI  }
 {STKDESC                               } {MNEM  } {PARTNO                      } BB'Upd ROPs/Min'    EXG  '+Other rec-ord'{SOHRO  }
 {STKDESC                               } {MNEM  } {PARTNO                      } BB'ABCD/XYZ Lvl'    YXW  '+Xfer Request' {SOHXF1 }
%* If no extended description:
%* Version 008 Now extended description in a different table
%*<IF STKSIZE = 0>
<IF STKED4001 = SPACES>
                                          {MNEM  } {PARTNO                      } BB'RAF/Srv Lvl'{X4}{SLVL}'+Xfer in Tran' {SOHXF2 }
    <IF TN <> SPACES>
'********** UN Trpt code :'{TN}'*********'{MNEM  } {PARTNO                      } BB'WH/Bin'{WH}{BIN       }  {BIN       }
    <ELSE>
                                          {MNEM  } {PARTNO                      } BB'WH/Bin'{WH}{BIN       }  {BIN       }
    <ENDIF>
 {TNDESC                                } {MNEM  } {PARTNO                      } BB'Inv.Pr' {IP          }'+Consign tran' {SOHCT  }
    <IF HZ <> SPACES>
'********** Hazardous Mat:'{HZ}'*********'{MNEM  } {PARTNO                      } BB'Inv.Val'{IV          }'+Consign SOH'  {SOHC   }
    <ELSE>
                                          {MNEM  } {PARTNO                      } BB'Inv.Val'{IV          }'+Consign SOH'  {SOHC   }
    <ENDIF>
 {HZDESC                                } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
                                          {MNEM  } {PARTNO                      } BB
    <IF SOHW < MINW>
'************MIN STOCK BREACH************'{MNEM  } {PARTNO                      } BB
    <ENDIF>
    <SUPPRESS>
                                          {MNEM  } {PARTNO                      } BB
    <IF EXPD <> SPACES AND EXPD < WX-TODAYS-DATE>
'***************FPA EXPIRED**************'{MNEM  } {PARTNO                      } BB
    <ELSE>
      <IF SFPA > 0>
        <IF ROV > 0>
          <IF MAXROV > MAXV>
'*Max value of FPA exceeded with this RO*'{MNEM  } {PARTNO                      } BB
          <ENDIF>
        <ELSE>
          <IF ESTRO > MAXV>
'*Max value of FPA exceeded with this RO*'{MNEM  } {PARTNO                      } BB
          <ENDIF>
        <ENDIF>
      <ENDIF>
    <ENDIF>
    <REPEAT>
    <SUPPRESS>
                                          {MNEM  } {PARTNO                      } BB
    <ENDREPEAT>
%* If extended description exists:
<ELSE>
%* Version 008 now extended text in MSF1CC 
 {STKED4001                             } {MNEM  } {PARTNO                      } BB'RAF/Srv Lvl'{X4}{SLVL}'+Xfer in Tran' {SOHXF2 }
 {STKED4002                             } {MNEM  } {PARTNO                      } BB'WH/Bin'{WH}{BIN      }  {BIN       }
 {STKED4003                             } {MNEM  } {PARTNO                      } BB'Inv.Pr' {IP          }'+Consign tran' {SOHCT  }
 {STKED4004                             } {MNEM  } {PARTNO                      } BB'Inv.Val'{IV          }'+Consign SOH'  {SOHC   }
'i' {STKED4005                             } {MNEM  } {PARTNO                      } BB
%*<REPEAT>
%*<SUPPRESS>
%*STKEXT                                } {MNEM  } {PARTNO                      } BB
%*<ENDREPEAT>
%*
%*     MC16052013
%*
%*     NEXT 80 LINES OF CODE WILL OUTPUT UP TO 40 LINES
%*     OF EXTENDED DESCRIPTION FOR A PURCHASE ORDER THAT
%*     RELATES TO A STOCKED ITEM
%*
    <SUPPRESS>
 {STKED4006                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4007                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4008                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4009                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4010                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4011                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4012                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4013                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4014                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4015                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4016                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4017                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4018                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4019                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4020                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4021                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4022                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4023                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4024                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4025                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4026                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4027                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4028                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4029                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4030                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4031                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4032                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4033                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4034                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4035                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4036                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4037                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4038                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4039                             } {MNEM  } {PARTNO                      } BB
    <SUPPRESS>
 {STKED4040                             } {MNEM  } {PARTNO                      } BB
%* Version 008 end
    <IF TN <> SPACES>
'********** UN Trpt code :'{TN} {TNDESC                                }'**********'
    <ENDIF>
    <IF HZ <> SPACES>
'********** Hazardous Mat:'{HZ} {HZDESC                                }'**********'
    <ENDIF>
    <IF SOHW < MINW>
'*********MIN STOCK BREACH*********'
    <ENDIF>
    <IF SFPA > 0>
        <IF EXPD <> SPACES AND EXPD < WX-TODAYS-DATE>
'***************FPA EXPIRED**************'
        <ELSE>
           <IF ROV > 0>
              <IF MAXROV > MAXV>
'*Max value of FPA exceeded with this RO*'
              <ENDIF>
           <ELSE>
              <IF ESTRO > MAXV>
'*Max value of FPA exceeded with this RO*'
              <ENDIF>
           <ENDIF>
        <ENDIF>
    <ENDIF>
<ENDIF>
<IF PS4 = 'Y'>
<SUPPRESS>
'Classifications   :Class-' C {CDESC                                 }'Type-' D {TDESC                                 }
<SUPPRESS>
'Stock Qualifiers  :'      FF {FNAME                                 }       FF {FNAME                                 }
      <REPEAT>
<SUPPRESS>
                           FF {FNAME                                 }       FF {FNAME                                 }
      <ENDREPEAT>
<ENDIF>
<IF PS6 = 'Y'>
'Significant Dates :'                      'Last Receipt'                 'Last Issue'                    'Last Dues In'
 'Item Creation Date'{ICDATE }         'Date'     {LRDATE }          'Date'          {LIDATE }     'Order/Date'  {LDO } {LDT    }
                                       'Order'    {LRO }             'Requisition'   {LIRQ}        'Expedite Code/Count' {EX} {W1}
 'Last Changed Date' {LCDATE }         'Supplier' {LRS }             'Responsibility'{LIRS    }    'Order Quantity'{LDOQ    }
                                       'Quantity' {LRQ     }         'Quantity'      {LIQ     }    'O/S Quantity  '{LDOSQ   }
<ENDIF>
%*commentary added below here
<IF PS10 = 'Y'>
  <IF SZSUPG > 0 OR SZSTG > 0 OR SZSSG > 0 OR SZSUPG1 > 0 OR SZSTG1 > 0 OR SZSSG1 > 0>
    <IF SZSUPG > 0>
'GlbSupPC:'{SUPGLOB                                                   } {SUPGLOB                                                   }
      <REPEAT>
<SUPPRESS>
           {SUPGLOB                                                   } {SUPGLOB                                                   }
      <ENDREPEAT>
    <ENDIF>
%*
    <IF SZSUPG1 > 0>
      <REPEAT>
'GlbSupAS:'{SUPGLOB1                                                  } {SUPGLOB1                                                  }
      <ENDREPEAT>
    <ENDIF>
    <IF SZSTG > 0>
%*
'GlbItmPC:'{STKGLOB                                                   } {STKGLOB                                                   }
      <REPEAT>
<SUPPRESS>
           {STKGLOB                                                   } {STKGLOB                                                   }
      <ENDREPEAT>
    <ENDIF>
%*
    <IF SZSTG1 > 0>
      <REPEAT>
'GlbSupAS:'{STKGLOB1                                                  } {STKGLOB1                                                  }
      <ENDREPEAT>
    <ENDIF>
%*
    <IF SZSSG > 0>
      <REPEAT>
<SUPPRESS>
'GlbS/IPC:'{SUPSTKGL                                                  } {SUPSTKGL                                                  }
      <ENDREPEAT>
    <ENDIF>
%*
    <IF SZSSG1 > 0>
      <REPEAT>
'GlbS/IAS:'{SUPSTKGL1                                                 } {SUPSTKGL1                                                 }
      <ENDREPEAT>
    <ENDIF>
   <ENDIF>
%*
  <IF SZSUPD > 0 OR SZSTD > 0 OR SZSSD > 0 OR SZSUPD1 > 0 OR SZSTD1 > 0 OR SZSSD1 > 0>
    <IF SZSUPD > 0>
'DstSupPC:'{SUPDST                                                    } {SUPDST                                                    }
      <REPEAT>
<SUPPRESS>
           {SUPDST                                                    } {SUPDST                                                    }
      <ENDREPEAT>
    <ENDIF>
%*
   <IF SZSUPD1 > 0>
      <REPEAT>
'DstSupAR:'{SUPDST1                                                   } {SUPDST1                                                   }
      <ENDREPEAT>
   <ENDIF>
%*
    <IF SZSTD > 0>
'DstItmPC:'{STKDST                                                    } {STKDST                                                    }
      <REPEAT>
           {STKDST                                                    } {STKDST                                                    }
      <ENDREPEAT>
    <ENDIF>
%*
    <IF SZSTD1 > 0>
      <REPEAT>
'DstItmAR:'{STKDST1                                                   } {STKDST1                                                   }
      <ENDREPEAT>
    <ENDIF>
%*
    <IF SZSSD > 0>
      <REPEAT>
'DstS/IPC:'{SUPSTKDST                                                 } {SUPSTKDST                                                 }
      <ENDREPEAT>
    <ENDIF>
%*
    <IF SZSSD > 0>
      <REPEAT>
'DstSupAR:'{SUPSTKDST1                                                } {SUPSTKDST1                                                }
      <ENDREPEAT>
    <ENDIF>
  <ENDIF>
<ENDIF>
%* commentary added above here
<IF PS8 = 'Y' OR PS9 = 'Y'>
%*'Usage Pattern - Last 18 periods:'
   <IF PS8 = 'Y'>
                                                                                                        'Lst 12 Mths Lst Yr Prev Yr'
'Usage :'   {CP1}   {UP1}   {UP1}   {UP1}   {UP1}   {UP1}   {UP1}   {UP1}   {UP1}   {UP1}   {UP1}   {UP1}   'Total'     {LY}    {PY}
'Unschd:'{CUSH1 }{USH1  }{USH1  }{USH1  }{USH1  }{USH1  }{USH1  }{USH1  }{USH1  }{USH1  }{USH1  }{USH1  }{USP    }{LUSP   }{PUSP  }
   <ENDIF>
   <IF PS9 = 'Y'>
'Sched :'{CSH1  }{SH1   }{SH1   }{SH1   }{SH1   }{SH1   }{SH1   }{SH1   }{SH1   }{SH1   }{SH1   }{SH1   }{SP     }{LSP    }{PSP   }
   <ENDIF>
<ENDIF>
%*DD0999 Inserted commentary details
<IF PS11 = 'Y'>
   <IF B46 > 0 OR B57 > 0 OR B69 > 0>
 'Global Commentary:'
      <IF B46 > 0>
  'Supplier:'{B36                                                       }
<REPEAT>
             {B36                                                       }
<ENDREPEAT>
<REPEAT>
             {B38                                                       }
<ENDREPEAT>
<REPEAT>
             {B40                                                       }
<ENDREPEAT>
<REPEAT>
             {B42                                                       }
<ENDREPEAT>
<REPEAT>
             {B44                                                       }
<ENDREPEAT>
      <ENDIF>
      <IF B57 > 0>
  'Item:'    {B47                                                       }
<REPEAT>
             {B47                                                       }
<ENDREPEAT>
<REPEAT>
             {B49                                                       }
<ENDREPEAT>
<REPEAT>
             {B51                                                       }
<ENDREPEAT>
<REPEAT>
             {B53                                                       }
<ENDREPEAT>
<REPEAT>
             {B55                                                       }
<ENDREPEAT>
      <ENDIF>
      <IF B69 > 0>
  'Supplier/Item:'
<REPEAT>
             {B59                                                       }
<ENDREPEAT>
<REPEAT>
             {B61                                                       }
<ENDREPEAT>
<REPEAT>
             {B63                                                       }
<ENDREPEAT>
<REPEAT>
             {B65                                                       }
<ENDREPEAT>
<REPEAT>
             {B67                                                       }
<ENDREPEAT>
      <ENDIF>
   <ENDIF>
   <IF B91 > 0 OR C02 > 0 OR C13 > 0>
 'District Commentary:'
      <IF B91 > 0>
  'Supplier:'{B81                                                       }
<REPEAT>
             {B81                                                       }
<ENDREPEAT>
<REPEAT>
             {B83                                                       }
<ENDREPEAT>
<REPEAT>
             {B85                                                       }
<ENDREPEAT>
<REPEAT>
             {B87                                                       }
<ENDREPEAT>
<REPEAT>
             {B89                                                       }
<ENDREPEAT>
      <ENDIF>
      <IF C02 > 0>
  'Item:'    {B92                                                       }
<REPEAT>
             {B92                                                       }
<ENDREPEAT>
<REPEAT>
             {B94                                                       }
<ENDREPEAT>
<REPEAT>
             {B96                                                       }
<ENDREPEAT>
<REPEAT>
             {B98                                                       }
<ENDREPEAT>
<REPEAT>
             {C00                                                       }
<ENDREPEAT>
      <ENDIF>
      <IF C13 > 0>
  'Supplier/Item:'
<REPEAT>
             {C03                                                       }
<ENDREPEAT>
<REPEAT>
             {C05                                                       }
<ENDREPEAT>
<REPEAT>
             {C07                                                       }
<ENDREPEAT>
<REPEAT>
             {C09                                                       }
<ENDREPEAT>
<REPEAT>
             {C11                                                       }
<ENDREPEAT>
      <ENDIF>
   <ENDIF>
<ENDIF>
<IF PS2 = 'Y'>
{L9                                                              }{L9                                                              }
'Preferred Supplier:'                     'Preferred Supplier Details:'
 {PSUP}  {PSNAME                        } 'Lead Time' QQQQ                              'Freight'SS       'Price'{PRICE         }
         {SADD1                         } 'Pr.Eff.Dte'{PEFD    }   'Pr.Exp.Dte'{PEXD   }'FPA/Ref'{PREF  } 'Pr Code' VV
         {SADD2                         }'-Disc/+Sur1'     {DA   }'-Disc/+Sur2'{DB   }  'Curr.'  {CU}     'U.O.P'   {UP}
         {SADD3                         } 'Conv.Fact' {CONV      } 'Std Pack'    {PK }  'Exped.' TT       'Ord Med' {OM }
<SUPPRESS>
'Tel/Fax'{STEL          } {SFAX          }'Tax Code'  {TC}         'Tax %'      {TPC }                    'Del Perf'{DL}
<SUPPRESS>
'Contact'{SCT                           }{STLX                }
{UNDERLINE                                                                                                                         }
<ELSE>
   <IF PS1 = 'Y'>
'Preferred Supplier:'
{PSUP} {PSNAME                        }{SADD1                         }{SADD2                         }{SADD3                      }
'Tel/Fax'{STEL          } {SFAX          }  'Telex'  {STLX                } 'Contact'{SCT                           }
   <ENDIF>
<ENDIF>
<IF PS3 = 'Y'>
   <IF ASSIZE > 0>
'Alt.Supplrs:'{ASUP} {ASNAME                       }'PC'{Y1}'A/S L/T'{AAL}{ASL}  {ASUP} {ASNAME                      }{Y1}{AAL}{ASL}
      <REPEAT>
<SUPPRESS>
              {ASUP} {ASNAME                       }'PC'{Y1}'A/S L/T'{AAL}{ASL}  {ASUP} {ASNAME                      }{Y1}{AAL}{ASL}
      <ENDREPEAT>
   <ENDIF>
<ENDIF>
<IF PS5 = 'Y'>
 <IF OHPOS > 0>
'Order Hist.: O/No'{OHPO}X{G1}'Date'{OHDATE } {OHS }'Pr'{OHPR        }     'O/No'{OHPO}X{G1}'Date'{OHDATE } {OHS }'Pr'{OHPR        }
   <REPEAT>
<SUPPRESS>
             'O/No'{OHPO}X{G1}'Date'{OHDATE } {OHS }'Pr'{OHPR        }     'O/No'{OHPO}X{G1}'Date'{OHDATE } {OHS }'Pr'{OHPR        }
   <ENDREPEAT>
 <ENDIF>
<ENDIF>
<IF PS7 = 'Y'>
 'Cross Referenced Stock Codes:'                       'Code Xref Description/'
  'Stock Code  Item Name/Part Number'                  'G/D  Comment'
   <REPEAT>
    {GSTK   }  {GINAME                                } {H1} {GXREF                                          }
                                                        'G'  {GCOM                                  }
   <ENDREPEAT>
   <REPEAT>
    {DSTK   }  {DINAME                                } {J1} {DXREF                                          }
                                                        'D'  {DCOM                                  }
   <ENDREPEAT>
<ENDIF>
<IF I <> SPACES>
'********* Recommended Order Recycled -  Recycle/Defer Code' II {RCDESC                                 }'Date '{IDATE }'*********'
<ENDIF>
<IF PS10 = 'Y'>
  <IF EXSIZE > 0 >
'RO Info :'{EXTRO                                                     } {EXTRO                                                     }
  <REPEAT>
           {EXTRO                                                     } {EXTRO                                                     }
  <ENDREPEAT>
  <ENDIF>
<ENDIF>
<IF WX-CENTRAL-PURCH = 'Y' AND WX-MULTIDSTRCT = '2'>
'Districts Holding Stock:'                       'Stock   ABCD/'
                                              'Class Type  XYZ   Available     S.O.H.    R.O.P.   Reorder Min Stock  Inventory Price'
  <REPEAT>
 {DR} {DNAME                                 }   K    M    N O  {D1      } {D2      } {D3     } {D4     } {D5     } {D6            }
  <ENDREPEAT>
<ENDIF>
%*
 {UNDERLINE                                                  }{L4   }{UNDERLINE                                                   }
 'Rec.Order Qty'{ROQI      } {L7 }'| Rec.Order Val.'{ROV         }'| Rec.Ord.Type-'{L6              }'|Calc.ROPs'{CROP   }{CR     }
'------------------*********-*****----------------------**********-----------------*****************---------------*******---******'
%*dd0999PAGE FOOTING
%*%BREAK STOCK-CODE FOOTING
<IF PS11 = 'Y'>
'Offers -   Supplier Name |Contact Officer|Phone No |Price  |L/Time|  Disc|Settle.Disc|UOP |C.Fct|Std Pk|Freight|Delivery|Signature'
'1 |                      |               |         |$      |      |     %|   %   Days|    |     |      |       |        | '
  '|Comments:______________________________________________________________________________________________________________________'
'2 |                      |               |         |$      |      |     %|   %   Days|    |     |      |       |        | '
  '|Comments:______________________________________________________________________________________________________________________'
'3 |                      |               |         |$      |      |     %|   %   Days|    |     |      |       |        | '
  '|Comments:______________________________________________________________________________________________________________________'
'Order Details- |Supp Code |Price Code|Frt Code|Del Code|PO Clauses|Recycle Code|Exped Code| P.O. No. | Item|Order Date| Due Date  '
               '|          |          |        |        |          |            |          |          |     |   /  /   |   /  /    '
               '*******************************************************************************************************************'

'QUOTATIONS INVITED IN ACCORDANCE WITH PROCUREMENT PROCEDURES - Signed .................... Date ........ Total Expenditure $......'

'OFFERS  ACCEPTED   IN ACCORDANCE WITH PROCUREMENT PROCEDURES - Signed .................... Title .................... Date .......'
<ENDIF>
%CONTROL REPORT A
       TRIM-REPORT
       DYNAMIC-PRINTER
%REPORT
       B
%REPORT-TITLE
       'REGISTER OF RECOMMENDED ORDER STORES REPORT'
%PAGE HEADING
'Stkline Stockcode Rec No. Run No.    Run Date  QI Code    Referred to           Date Referred  Date Returned             Comments'
%DETAIL
{PNOSL} {STK    }   AAA    {RUN-NO}'   '{RUN-DTE}  {EMPIV} L                      L              L             L
{L9                                                              }{L9                                                              }
%SUMMARY


'Total Number of Recommended Order Stores = '{ROSCOUNT}     'Total Value = '{ROSTOTAL     }
%CONTROL REPORT B
       TRIM-REPORT
       DYNAMIC-PRINTER
%REQUEST-PARAMETERS
       RUN-NO LIKE RUN-NUMBER      TEXT 'Run Number'
       EMP-ID LIKE INVT-CTLLER     TEXT 'Inventory Controller'
       INVT-CNTL-TEAM PIC (X(10))  TEXT 'Inventory Controller Team'
       SUPP-NO LIKE SUPPLIER-NO    TEXT 'Supplier'
       GRP-CLASS LIKE CATEG-ID     TEXT 'Group Class'
       DEFPRIN LIKE PRINTER1 OF MSF080
%VARIABLES
       ROSCOUNT = count (*)
       RNOX = MSB240-NXT-RUN-9 OF MSF000 -
                       WHERE (DSTRCT-CODE      = %DISTRICT-CODE%, -
                              CONTROL-REC-TYPE = 'DC', -
                              CONTROL-REC-NO   = '0002') CONSTANT
       RNO1 = NUMERIC (RNOX) CONSTANT D-PIC (9(4)) I-PIC (9(4))
       RNO = CALC (RNO1 - 1) CONSTANT D-PIC (9(4)) I-PIC (9(4))
       RUN-NO = CHOOSE (%RUN-NO% IF (%RUN-NO% <> SPACES ,%RUN-NO% <> ZEROES), -
                        RNO IF (RNO <> 0), 1) I-PIC (9(4)) D-PIC(9(4)) CONSTANT
%*     Dates for use in mss175 routines for total usage of last &prev. year.
       CURR-YEAR = numeric (WX-TODAYS-YY) I-PIC (9(2)) CONSTANT
       LAST-YEAR = calc (CURR-YEAR - 1) I-PIC (S9(2)) CONSTANT
       PREV-YEAR = calc (CURR-YEAR - 2) I-PIC (S9(2)) CONSTANT
       LAST-YEAR-Y = choose (LAST-YEAR IF (LAST-YEAR >= 0),99) I-PIC (9(2)) CONSTANT
       PREV-YEAR-Y = choose (PREV-YEAR IF (PREV-YEAR >= 0),98) I-PIC (9(2)) CONSTANT
       LYP = catenate (LAST-YEAR-Y,12) CONSTANT
       PYP = catenate (PREV-YEAR-Y,12) CONSTANT
       LY = catenate ('`', LAST-YEAR-Y) CONSTANT
       PY = catenate ('`', PREV-YEAR-Y) CONSTANT
       RUN-DTE = RUN-S-DATE FORMAT DATE
       WH = WHOUSE-ID
       DC = DSTRCT-CODE
       EMPIV = INVT-CTLLER
       IVNAME1 = hrget  (EMPLOYEE-ID -
                        from ('MSSEMP,MSF810') -
                        key  (EMPLOYEE-ID = EMPIV)
       IVNAME  = FORMATTED-NAME via (IVNAME1)

       EMPPO = PURCH-OFFICER
       PONAME1 = hrget  (EMPLOYEE-ID -
                        from ('MSSEMP,MSF810') -
                        key  (EMPLOYEE-ID = EMPPO)
       PONAME  = FORMATTED-NAME via (PONAME1)
       SUP = SUPPLIER-NO
       SNAME = SUPPLIER-NAME OF MSF200 WHERE (SUPPLIER-NO = SUP)
       GC =  CATEG-ID
       GC1 = SUBSTR(CATEG-ID,1,2)
       GC2 = SUBSTR(CATEG-ID,3,2)
       GCDESC = GC-DESC-LN OF MSF160 WHERE (GROUP-CODE = GC1, -
               CLASS-CODE = GC2)
       STK = STOCK-CODE
       A = ACTIVITY-CTR
       INAME = ITEM-NAME OF MSF100 WHERE (STOCK-CODE = STOCK-CODE)
       STKDESC = DESC-LINE VIA (INAME)
       EXT = CAT-EXT-UUID VIA (INAME)
       HZ = HAZARD-MAT VIA (INAME)
       HZDESC = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'HZ', -
               TABLE-CODE = HZ)
       TN = UN-TRANSP-CODE VIA (INAME)
       TNDESC = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'TN', -
               TABLE-CODE = TN)
%*DD0999 Inserted MSF010
    D49 = TABLE-CODE OF MSF010 -
    WHERE (TABLE-TYPE             = 'CS', -
           TABLE-CODE            >= SPACES) -
    SELECTIF (ASSOC-CHAR-14 = 'Y') -
    MAX(5) -
    CONSTANT
    B26 = SINGLE(D49 (1 )) CONSTANT
    B27 = SUBSTR(B26 ,1 ,2 ) CONSTANT
    B28 = SINGLE(D49 (2 )) CONSTANT
    B29 = SUBSTR(B28 ,1 ,2 ) CONSTANT
    B30 = SINGLE(D49 (3 )) CONSTANT
    B31 = SUBSTR(B30 ,1 ,2 ) CONSTANT
    B32 = SINGLE(D49 (4 )) CONSTANT
    B33 = SUBSTR(B32 ,1 ,2 ) CONSTANT
    B34 = SINGLE(D49 (5 )) CONSTANT
    B35 = SUBSTR(B34 ,1 ,2 ) CONSTANT

    D50 = TABLE-CODE OF MSF010 -
    WHERE (TABLE-TYPE             = 'CS', -
           TABLE-CODE            >= SPACES) -
    SELECTIF (ASSOC-CHAR-4 = 'Y') -
    MAX(5) -
    CONSTANT
    B70 = SINGLE(D50 (1 )) CONSTANT
    B71 = SUBSTR(B70 ,1 ,2 ) CONSTANT
    B74 = SINGLE(D50 (3 )) CONSTANT
    B75 = SUBSTR(B74 ,1 ,2 ) CONSTANT
    B72 = SINGLE(D50 (2 )) CONSTANT
    B73 = SUBSTR(B72 ,1 ,2 ) CONSTANT
    B76 = SINGLE(D50 (4 )) CONSTANT
    B77 = SUBSTR(B76 ,1 ,2 ) CONSTANT
    B78 = SINGLE(D50 (5 )) CONSTANT
    B79 = SUBSTR(B78 ,1 ,2 ) CONSTANT

%* DYNAMIC PRINTER
%* The +WH Table set-up for Stores Recommended Order Report Printer
%* will be used.  Positions 5-6 of the Associated Record.
%*
       PRINS    = ASSOC-REC OF MSF010          -
                  WHERE   (TABLE-TYPE = '+WH', -
                           TABLE-CODE =  DC & WH)
       PRINW    = substr(PRINS,5,2)   I-PIC (X(2))

%* Printing priority:
%* (1) +WH table set-up
%* (2) Default printer

       PRINA = choose (PRINW IF (PRINW <> SPACES), -
                      %DEFPRIN%)
%*
       PRINX    = PRINTER (PRINA)
%*
    B36 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B27 ) SUPPLIER-VALUE(SUPPLIER-NO )  ) MAX(20 ) TEXT-WIDTH(60 )
    B37 = SIZE(B36 )
    B38 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B29 ) SUPPLIER-VALUE(SUPPLIER-NO )  ) MAX(20 ) TEXT-WIDTH(60 )
    B39 = SIZE(B38 )
    B40 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B31 ) SUPPLIER-VALUE(SUPPLIER-NO )  ) MAX(20 ) TEXT-WIDTH(60 )
    B41 = SIZE(B40 )
    B42 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B33 ) SUPPLIER-VALUE(SUPPLIER-NO )  ) MAX(20 ) TEXT-WIDTH(60 )
    B43 = SIZE(B42 )
    B44 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B35 ) SUPPLIER-VALUE(SUPPLIER-NO )  ) MAX(20 ) TEXT-WIDTH(60 )
    B45 = SIZE(B44 )
    B46 = CALC ( B37 + B39 + B41 + B43 + B45 )
    C03 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B71 ) SUPPLIER-VALUE(SUPPLIER-NO ) DISTRICT-VALUE(%DISTRICT-CODE% )-
            STOCK-CODE-VALUE(STOCK-CODE )) MAX(20 ) TEXT-WIDTH(60 )
    C04 = SIZE(C03 )
    C05 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B73 ) SUPPLIER-VALUE(SUPPLIER-NO ) DISTRICT-VALUE(%DISTRICT-CODE% )-
            STOCK-CODE-VALUE(STOCK-CODE )) MAX(20 ) TEXT-WIDTH(60 )
    C06 = SIZE(C05 )
    B92 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B71 ) STOCK-CODE-VALUE(STOCK-CODE ) DISTRICT-VALUE(%DISTRICT-CODE% ))-
            MAX(20 ) TEXT-WIDTH(60 )
    B93 = SIZE(B92 )
    C00 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B79 ) STOCK-CODE-VALUE(STOCK-CODE ) DISTRICT-VALUE(%DISTRICT-CODE% ))-
            MAX(20 ) TEXT-WIDTH(60 )
    C01 = SIZE(C00 )
    B98 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B77 ) STOCK-CODE-VALUE(STOCK-CODE ) DISTRICT-VALUE(%DISTRICT-CODE% ))-
            MAX(20 ) TEXT-WIDTH(60 )
    B99 = SIZE(B98 )
    B96 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B75 ) STOCK-CODE-VALUE(STOCK-CODE ) DISTRICT-VALUE(%DISTRICT-CODE% ))-
/            MAX(20 ) TEXT-WIDTH(60 )
    B97 = SIZE(B96 )
    B94 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B73 ) STOCK-CODE-VALUE(STOCK-CODE ) DISTRICT-VALUE(%DISTRICT-CODE% ))-
            MAX(20 ) TEXT-WIDTH(60 )
    B95 = SIZE(B94 )
    C02 = CALC ( B93 + B95 + B97 + B99 + C01 )
    C07 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B75 ) SUPPLIER-VALUE(SUPPLIER-NO ) DISTRICT-VALUE(%DISTRICT-CODE% )-
            STOCK-CODE-VALUE(STOCK-CODE )) MAX(20 ) TEXT-WIDTH(60 )
    B81 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B71 ) SUPPLIER-VALUE(SUPPLIER-NO ) DISTRICT-VALUE(%DISTRICT-CODE% ) )-
            MAX(20 ) TEXT-WIDTH(60 )
    B80 = SUPPLIER-NO
    B89 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B79 ) SUPPLIER-VALUE(B80 ) DISTRICT-VALUE(%DISTRICT-CODE% ) ) MAX(20 )-
            TEXT-WIDTH(60 )
    B90 = SIZE(B89 )
    B87 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B77 ) SUPPLIER-VALUE(SUPPLIER-NO ) DISTRICT-VALUE(%DISTRICT-CODE% ) )-
            MAX(20 ) TEXT-WIDTH(60 )
    B85 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B75 ) SUPPLIER-VALUE(SUPPLIER-NO ) DISTRICT-VALUE(%DISTRICT-CODE% ) )-
            MAX(20 ) TEXT-WIDTH(60 )
    B86 = SIZE(B85 )
    B83 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B73 ) SUPPLIER-VALUE(SUPPLIER-NO ) DISTRICT-VALUE(%DISTRICT-CODE% ) )-
            MAX(20 ) TEXT-WIDTH(60 )
    B84 = SIZE(B83 )
    B88 = SIZE(B87 )
    B82 = SIZE(B81 )
    B91 = CALC ( B82 + B84 + B86 + B88 + B90 )
    C08 = SIZE(C07 )
    C09 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B77 ) SUPPLIER-VALUE(SUPPLIER-NO ) DISTRICT-VALUE(%DISTRICT-CODE% )-
            STOCK-CODE-VALUE(STOCK-CODE )) MAX(20 ) TEXT-WIDTH(60 )
    C10 = SIZE(C09 )
    C11 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B79 ) SUPPLIER-VALUE(SUPPLIER-NO ) DISTRICT-VALUE(%DISTRICT-CODE% )-
            STOCK-CODE-VALUE(STOCK-CODE )) MAX(20 ) TEXT-WIDTH(60 )
    C12 = SIZE(C11 )
    C13 = CALC ( C04 + C06 + C08 + C10 + C12 )
    B11 = GET (READ-TEXT FROM ('MSF096') CODE ('RO' ) KEY(DSTRCT-CODE ,STOCK-CODE ,ACTIVITY-CTR )) MAX(20 ) TEXT-WIDTH(60 )
    B12 = SIZE(B11 )

    B61 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B29 ) SUPPLIER-VALUE(SUPPLIER-NO )  STOCK-CODE-VALUE(STK )) MAX(20 )-
            TEXT-WIDTH(60 )
    B62 = SIZE(B61 )
    B65 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B33 ) SUPPLIER-VALUE(SUPPLIER-NO )  STOCK-CODE-VALUE(STK )) MAX(20 )-
            TEXT-WIDTH(60 )
    B66 = SIZE(B65 )
    B59 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B27 ) SUPPLIER-VALUE(SUPPLIER-NO )  STOCK-CODE-VALUE(STK )) MAX(20 )-
            TEXT-WIDTH(60 )
    B67 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B35 ) SUPPLIER-VALUE(SUPPLIER-NO )  STOCK-CODE-VALUE(STK )) MAX(20 )-
            TEXT-WIDTH(60 )
    B60 = SIZE(B59 )
    B63 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B31 ) SUPPLIER-VALUE(SUPPLIER-NO )  STOCK-CODE-VALUE(STK )) MAX(20 )-
            TEXT-WIDTH(60 )
    B64 = SIZE(B63 )
    B68 = SIZE(B67 )

    B69 = CALC ( B60 + B62 + B64 + B66 + B68 )
    B49 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B29 ) STOCK-CODE-VALUE(STOCK-CODE ) ) MAX(20 ) TEXT-WIDTH(60 )
    B50 = SIZE(B49 )
    B47 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B27 ) STOCK-CODE-VALUE(STOCK-CODE ) ) MAX(20 ) TEXT-WIDTH(60 )
    B48 = SIZE(B47 )
    B55 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B35 ) STOCK-CODE-VALUE(STOCK-CODE ) ) MAX(20 ) TEXT-WIDTH(60 )
    B56 = SIZE(B55 )
    B53 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B33 ) STOCK-CODE-VALUE(STOCK-CODE ) ) MAX(20 ) TEXT-WIDTH(60 )
    B54 = SIZE(B53 )
    B51 = GET (READ-TEXT FROM ('MSF096') CODE ('CS' ) TYPE (B31 ) STOCK-CODE-VALUE(STOCK-CODE ) ) MAX(20 ) TEXT-WIDTH(60 )
    B52 = SIZE(B51 )
    B57 = CALC ( B48 + B50 + B52 + B54 + B56 )
%*DD0999
       MNEM   = MNEMONIC OF MSF110A WHERE (DSTRCT-CODE = SPACES, -
                STOCK-CODE = STOCK-CODE, PREF-PART-IND >= SPACES) -
                REJECTIF (PREF-PART-IND = '99') -
                MAX (30)
       PARTNO = PART-NO VIA (MNEM)
       BG     = PREF-PART-IND VIA (MNEM)
       B111 = SUBSTR(BG,1,1)
       B122  = SUBSTR(BG,1,2)
       B21  = SUBSTR(BG,2,1)
       BS   = CATENATE (' ',B21)
       B    = CHOOSE (BS IF (B111 = '0'), B122)
       PPP = CATENATE ('-', DSTRCT-CODE)
       MNEMG = MNEMONIC OF MSF110A WHERE (DSTRCT-CODE = '    ', -
               STOCK-CODE = STOCK-CODE, PREF-PART-IND >= SPACES) -
                            MAX (30)
%* EF taken-out to fix the problem
%*              REJECTIF ( PREF-PART-IND-9 = '97' AND -
%*                         MNEMONIC <> '-GENL' AND -
%*                         MNEMONIC <> '-TRAN' AND -
%*                         MNEMONIC <> PPP) MAX (30)
       PARTNOG = PART-NO VIA (MNEMG)
       Z = PREF-PART-IND-9 VIA (MNEMG)
%* Stockline No.
       PNOSLD = PART-NO OF MSF110A WHERE (DSTRCT-CODE = DSTRCT-CODE, -
              STOCK-CODE = STOCK-CODE, PREF-PART-IND >= '97') -
              SELECTIF ( MNEMONIC = '-GENL') -
              SELECTIF ( MNEMONIC = PPP) -
              SELECTIF ( MNEMONIC = '-TRAN') -
              MAX (1)
%*              STOPIF (PREF-PART-IND > '97') MAX (1)
       PNOSLG = PART-NO OF MSF110A                  -
                WHERE    (DSTRCT-CODE >= SPACES)    -
                REJECTIF (STOCK-CODE  <> STOCK-CODE)-
                REJECTIF (DSTRCT-CODE <> SPACES)    -
                REJECTIF (PREF-PART-IND <> '97')    -
                MAX (1)
%*              STOPIF (PREF-PART-IND > '97') MAX (1)
       PNOSL = choose (PNOSLD IF (PNOSLD <> SPACES), PNOSLG)
       DSC = DSTRCT-CODE
       DS = choose (DSC IF (WX-CENTRAL-PURCH = 'Y' AND -
            WX-MULTIDSTRCT = '2'), SPACES)

       ROPT = ROP OF MSF170 WHERE (DSTRCT-CODE = DSTRCT-CODE, -
              STOCK-CODE = STOCK-CODE)
       RQTY = REORDER-QTY VIA (ROPT)
       MINS = MIN-STOCK-LVL VIA (ROPT)
       UI = UNIT-OF-ISSUE VIA (ROPT)
       E = ROP-ROQ-UPDATE VIA (ROPT)
       G = MIN-STK-UPDATE VIA (ROPT)
       H = INVENTORY-FLAG VIA (ROPT)
       J = PURCH-FLAG VIA (ROPT)
       SLVL = PLANNED-SLEVEL VIA (ROPT) D-PIC (ZZ9.99)
       X4 = RAF VIA (ROPT)
       Y = ABCD-LEVEL VIA (ROPT)
       W = XYZ-LEVEL VIA (ROPT)
%*     WH = HOME-WHOUSE VIA (ROPT)
       IV = INVENT-VALUE VIA (ROPT)
       IP = INVENT-COST-PR VIA (ROPT) D-PIC (ZZZZZZZZZZ9.99)
       CUS1= CUSTODIAN-ID OF MSF1CSA -
       WHERE (DSTRCT-CODE            = DSTRCT-CODE, -
              WHOUSE-ID             >= WH, -
              WHOUSE-ID             <= WH) -
       MAX (1)
       BIN = BIN-CODE OF MSF1HB -
       WHERE (CUSTODIAN-ID           = CUS1, -
              STOCK-CODE             = STOCK-CODE, -
              BIN-CODE              >= SPACES) -
       MAX (2)
       SOHO = DSTRCT-OWN-SOH OF MSSSOH -
       WHERE (OPTION-SOH             = '1',-
              DSTRCT-CODE            = DSTRCT-CODE, -
              STOCK-CODE             = STOCK-CODE, -
              DSTRCT-SOH-REQ-SW      = 'Y')
       SOHC = DSTRCT-CON-SOH VIA (SOHO) D-PIC (--------9)
%* SC4261240 start (version 007)
%*       SOHDO = DUES-OUT VIA (ROPT) D-PIC (--------9)
%*       SOHB = TOTAL-PICKED VIA (ROPT) D-PIC (--------9)
%* SC4261240 end
       SOHR = RESERVED VIA (ROPT) D-PIC (--------9)
       SOHOT = IN-TRANSIT VIA (ROPT) D-PIC (--------9)
       SOHCT = CONSIGN-ITRANS VIA (ROPT) D-PIC (--------9)
%* SC4261240 start (version 007)
%*       SOHDI = DUES-IN VIA (ROPT) D-PIC (--------9)
%* SC4261240 end
       SOHXF1 = XFERS-REQUEST VIA (ROPT) D-PIC (--------9)
       SOHXF2 = XFERS-IN-TRANS VIA (ROPT) D-PIC (--------9)
       SOHR1 = ROQ  VIA (ROPT) D-PIC (--------9)
       SIN = CALC (SOHO + SOHC)
       SOUT = CALC (TOTAL-PICKED VIA (ROPT) + DUES-OUT VIA (ROPT))
       SOHA = CALC (SIN - SOUT) D-PIC (--------9)
       SOHW = WH-OWN-SOH OF MSSSOH -
       WHERE (OPTION-SOH             = '2', -
              DSTRCT-CODE            = DSTRCT-CODE, -
              STOCK-CODE             = STOCK-CODE, -
              WHOUSE-ID              = WH, -
              BYPASS-CAT-SEC-SW      = 'Y', -
              WH-SOH-REQ-SW          = 'Y')
       MINW = MIN-STOCK-LVL OF MSF180 -
       WHERE  (DSTRCT-CODE           = DSTRCT-CODE, -
               STOCK-CODE            = STOCK-CODE, -
               WHOUSE-ID             = WH) 
%* SC4261240 start (version 007)
       MAXS  = MAX-STOCK-LVL VIA (MINW)
       SOHDO = DUES-OUT  VIA (MINW) D-PIC (--------9)
       SOHDI = DUES-IN VIA (MINW) D-PIC (--------9)
       SOHB  = WHOUSE-PICKED  VIA (MINW)  D-PIC (--------9)
%* SC4261240 end
       EXTRO = GET (READ-TEXT FROM ('MSF096') CODE ('RO') -
                    KEY (DSTRCT-CODE, STOCK-CODE, A))
       EXSIZE = SIZE (EXTRO)
       L3 = choose ('Additional information exists for this Recommended Order' -
            IF (EXSIZE > 0), SPACES)
       I = DEF-RCYCLE-CDE
       IDATE = DEFER-DATE FORMAT (DATE)
       RCDESC = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'RJ', -
                TABLE-CODE = I)
%* Other Districts Info :
       DR = DSTRCT-CODE OF MSF170A WHERE (STOCK-CODE-1 >= STOCK-CODE) -
            STOPIF (STOCK-CODE-1 <> STOCK-CODE) MAX (3) -
            IF (WX-CENTRAL-PURCH = 'Y' AND WX-MULTIDSTRCT = '2') ELSE (SPACES)
       DNAME = DSTRCT-NAME OF MSF000 -
                     WHERE (DSTRCT-CODE       = DR, -
                            CONTROL-REC-TYPE  = 'DC', -
                            CONTROL-REC-NO    = '0001')
       K = CLASS VIA (DR)
       M = STOCK-TYPE VIA (DR)
       N = ABCD-LEVEL VIA (DR)
       O = XYZ-LEVEL VIA (DR)
       D1 = STOCK-AVAILABLE OF MSSSOH -
       WHERE (OPTION-SOH             = '1', -
              DSTRCT-CODE            = DSTRCT-CODE, -
              STOCK-CODE             = STOCK-CODE, -
              BYPASS-CAT-SEC-SW      = 'Y')
       D2  = DSTRCT-OWN-SOH OF MSSSOH -
       WHERE (OPTION-SOH             = '1',-
              DSTRCT-CODE            = DR, -
              STOCK-CODE             = STOCK-CODE, -
              DSTRCT-SOH-REQ-SW      = 'Y')
       D3 = ROP VIA (DR)
       D4 = REORDER-QTY VIA (DR)
       D5 = MIN-STOCK-LVL VIA (DR)
       D6 = INVENT-VALUE VIA (DR)
       L4 = 'SUMMARY'
       L5 = '|USAGE'
       L6 = choose ('System Generated' IF (CREATION-TYPE = 'S'), -
            'Manually Generated')
       L = '|'
       P = choose (WX-NO-OF-PERIODS IF (WX-NO-OF-PERIODS > 0),12) D-PIC (99)
       USP = ANN-UNSCHED-USAGE OF MSS175 WHERE (OPTION = 'G', -
                     DSTRCT-CODE = DSTRCT-CODE, STOCK-CODE = STOCK-CODE, -
                     WHOUSE-ID = SPACES, CURR-PERIOD = WX-STORES-CP, -
                     CURR-REQ-SW = 'Y', PAST-FUTURE-SW = 'P', -
                     ZERO-USAGES-SW = 'Y', NO-OF-USAGES-9 = 12, -
                     NO-OF-PERIODS-9 = 12)
       SP = ANN-SCHED-USAGE VIA (USP)

       LUSP = ANN-UNSCHED-USAGE OF MSS175 WHERE (OPTION = 'G', -
                     DSTRCT-CODE = DSTRCT-CODE, STOCK-CODE = STOCK-CODE, -
                     WHOUSE-ID = SPACES, CURR-PERIOD = LYP, -
                     CURR-REQ-SW = 'Y', PAST-FUTURE-SW = 'P', -
                     ZERO-USAGES-SW = 'Y', NO-OF-USAGES-9 = 12, -
                     NO-OF-PERIODS-9 = 12)
       LSP = ANN-SCHED-USAGE VIA (LUSP)

       PUSP = ANN-UNSCHED-USAGE OF MSS175 WHERE (OPTION = 'G', -
                     DSTRCT-CODE = DSTRCT-CODE, STOCK-CODE = STOCK-CODE, -
                     WHOUSE-ID = SPACES, CURR-PERIOD = PYP, -
                     CURR-REQ-SW = 'Y', PAST-FUTURE-SW = 'P', -
                     ZERO-USAGES-SW = 'Y', NO-OF-USAGES-9 = 12, -
                     NO-OF-PERIODS-9 = 12)
       PSP = ANN-SCHED-USAGE VIA (PUSP)

       USAV = CALC (USP / P)
       SAV = CALC (SP / P)
%*  MEAN ABSOLUTE DEVIATION
       USMAD = ACT-SOH-OWNED VIA (USP)
       SMAD = ACT-SOH-CONS VIA (USP)
       ALPH = ALPHA-FACTOR VIA (ROPT)
       V = PRICE-CODE VIA (ROPT)
%* Unscheduled Usage last 18 periods
       UP1 = PER-DISP OF MSS175 WHERE (OPTION = 'G', -
                     DSTRCT-CODE = DSTRCT-CODE, STOCK-CODE = STOCK-CODE, -
                     WHOUSE-ID = SPACES, CURR-PERIOD = WX-STORES-CP, -
                     CURR-REQ-SW = 'Y', PAST-FUTURE-SW = 'P', -
                     ZERO-USAGES-SW = 'Y', NO-OF-USAGES-9 = 12, -
                     NO-OF-PERIODS-9 = 12)
       USH1 = UNSCHED-USAGE VIA (UP1)
%* Scheduled Usage last 18 periods
       SP1 = PER-DISP VIA (UP1)
       SH1 = SCHED-USAGE VIA (UP1)
%* Current Period Usage
       CUSH1 = CURR-UNSCHED-USAGE VIA (UP1)
       CSH1 = CURR-SCHED-USAGE VIA (UP1)
       CP1 = CURR-PER-DISP VIA (UP1)
%* Unscheduled Usage last 18 periods
       PER18 = PER-DISP-9 VIA (UP1)
       PERYY = SUBSTR (PER18,4,2)
       PERMM = SUBSTR (PER18,1,2)
       PYYMM = CATENATE (PERYY,PERMM) D-PIC (9(4))
       ROQI = ROQ
       SOHRO = CALC (SOHR1 - ROQI)
       ST1 = TAX-PERCENT
       ST = choose (ST1 IF (WX-SALES-TAX-FLAG = 'Y'), ZERO)
       GPI = GROSS-PRICE-I
       GP2 = calc ( GPI + ((GPI * DISCOUNT-A) / 100 ))
       GP3 = calc ( GP2 + ((GP2 * DISCOUNT-B) / 100 ))
       NETP = calc (GP3 + ((GP3 * ST) / 100))
       ROV = calc (ROQI * NETP)
       ROSTOTAL = total (ROV)
       L7 = '(UOI)'
       PG = G-BLANK-LINES-9 OF MSF001 WHERE (DSTRCT-CODE = DSTRCT-CODE, -
            CTL-REC-TYPE = 'RO', CONTROL-REC-NO = SPACES)
       PD = D-BLANK-LINES-9 VIA (PG)
       PS1 = PRINT-STORES-1 VIA (PG)
       PS2 = PRINT-STORES-2 VIA (PG)
       PS3 = PRINT-STORES-3 VIA (PG)
       PS4 = PRINT-STORES-4 VIA (PG)
       PS5 = PRINT-STORES-5 VIA (PG)
       PS6 = PRINT-STORES-6 VIA (PG)
       PS7 = PRINT-STORES-7 VIA (PG)
       PS8 = PRINT-STORES-8 VIA (PG)
       PS9 = PRINT-STORES-9 VIA (PG)
       PS10 = PRINT-STORES-10 VIA (PG)
       PS11 = PRINT-STORES-11 VIA (PG)
%* Preferred Supplier
       PSUP = CURR-SUPPLIER VIA (ROPT)
       PSNAME = SUPPLIER-NAME OF MSF200 WHERE (SUPPLIER-NO = PSUP)
       SADD1 = ORDER-ADDR-1 VIA (PSNAME)
       SADD2 = ORDER-ADDR-2 VIA (PSNAME)
       SADD3 = ORDER-ADDR-3 VIA (PSNAME)
       STEL = ORDER-PHONE VIA (PSNAME)
       SFAX = ORDER-FAX-NO VIA (PSNAME)
       STLX = ORDER-TLX-NO VIA (PSNAME)
       SCT = ORDER-CONTACT VIA (PSNAME)
%* Preferred Supplier Details
       Q = SUPP-LEAD-TIME-9 OF MSF210 WHERE (DSTRCT-CODE = DSTRCT-CODE, -
           STOCK-CODE = STOCK-CODE, SUPPLIER-NO = PSUP, PRICE-CODE = V) FORMAT (BWZ)
       PARTA210 = MAN-PART-A VIA (Q)
       PARTB210 = MAN-PART-B VIA (Q)
       PARTC210 = MAN-PART-C VIA (Q)
       MMA210 = MAN-MNEMONIC-A VIA (Q)
       MMB210 = MAN-MNEMONIC-B VIA (Q)
       MMC210 = MAN-MNEMONIC-C VIA (Q)
       S = FREIGHT-CODE VIA (Q)
       PRICE = GROSS-PRICE-I VIA (Q)
       PEFD = PRICE-EFF-DATE VIA (Q) FORMAT DATE
       PEXD = PRICE-EXP-DATE VIA (Q) FORMAT DATE
       PREF = PRICE-UPD-REF VIA (Q)
       DA = DISCOUNT-A VIA (Q) D-PIC (+++9.99)
       DB = DISCOUNT-B VIA (Q) D-PIC (+++9.99)
       CU = CURRENCY-TYPE VIA (Q)
       UP = UNIT-OF-PURCH VIA (Q)
       CONV = CONV-FACTOR VIA (Q) FORMAT (BWZ)
       PK = STD-PACK VIA (Q) D-PIC (ZZZZ9)
       T = EXPEDITE-CODE VIA (Q)
       OMI = ORD-MEDIUM-IND VIA (Q)
       OM = choose ('Telex' IF (OMI = 'T'), 'Fax' IF (OMI = 'F'), -
                    'Print' IF (OMI = 'P'), 'EDI' IF (OMI = 'E'), -
                    SPACES)
       TC = TAX-CODE VIA (Q)
       TPC = TAX-PERCENT VIA (Q) FORMAT (BWZ)
       FPAT = FPA-REC-TYPE VIA (Q)
       FPAID = FPA-ID VIA (Q)
       FPAG = SUBSTR(FPAID,1,5)
       FPAA = SUBSTR(FPAID,6,3)
       FPAGG = FPA-GROUP OF MSF254 -
       WHERE  (FPA-REC-TYPE          = FPAT, -
               FPA-GROUP             = FPAG, -
               FPA-AGREEMENT         = FPAA, -
               FPA-ITEM-NO           = ZEROS, -
               DSTRCT-CODE           = SPACES)
       SFPA = SIZE (FPAGG)
       CUMV = CUMM-VALUE VIA (FPAGG)
       MAXV = MAX-VALUE VIA (FPAGG)
       MAXROV = CALC (ROV + CUMV)
       ESTRO  = CALC ((ROQI * IP) + CUMV)
       EXPD   = EXPIRY-DATE OF MSF250 -
       WHERE    (FPA-REC-TYPE        = FPAT, -
                 FPA-GROUP           = FPAG)
       U = NO-ITEM-ORDER VIA (PSNAME)
       XM = CLOSE-XMAS VIA (PSNAME)
       DL = DELIV-PERF-RTE OF MSF203 WHERE (DSTRCT-CODE = DSTRCT-CODE, -
            SUPPLIER-NO = PSUP) FORMAT (BWZ)
%* MSS240 ROQ and REORDER-QTY
%*    Following reinstated when data dict fixed
       CROP = ROP OF MSS240 WHERE (OPTION-240 = '7',STOCK-CODE = STK, -
                   INVENT-COST-PR = IP, ALPHA-FACTOR = ALPH, -
                   ABCD-LEVEL = N, SUPPLIER-NO = SUP, -
                   PRICE-CODE = V, CONV-FACTOR = CONV, -
                   SUPP-LEAD-TIME = Q, FREIGHT-CODE = S, -
                   STD-PACK = PK, PLANNED-SLEVEL = SLVL, -
                   RAF = X4, INVENTORY-FLAG = H, PURCH-FLAG =J) D-PIC (ZZZZZZZ9)
       CR = REORDER-QTY VIA (CROP) D-PIC (ZZZZZZZ9)
%* Alternate Suppliers
       ASUP = SUPPLIER-NO OF MSF210 WHERE (DSTRCT-CODE = DSTRCT-CODE, -
              STOCK-CODE = STOCK-CODE, SUPPLIER-NO >= SPACES) -
              REJECTIF (SUPPLIER-NO = PSUP) MAX (4)
       ASSIZE = SIZE (ASUP)
       Y1 = PRICE-CODE VIA (ASUP)
       ASL = SUPP-LEAD-TIME VIA (ASUP)
       AAL = LAST-ACT-LEAD  VIA (ASUP)
       ASNAME = SUPPLIER-NAME OF MSF200 WHERE (SUPPLIER-NO = ASUP)
%* Classifications
%* DG Use class/type from msf170 (via ropt) NOT msf100 (via iname)
       C = CLASS VIA (ROPT)
       CDESC = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'CL', -
               TABLE-CODE = C)
       D = STOCK-TYPE VIA (ROPT)
       TDESC = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'ST', -
               TABLE-CODE = D)
       E0 = STOCK-SECTION VIA (INAME)
       E1 = STOCK-SECTION-1 VIA (INAME)
       E2 = STOCK-SECTION-2 VIA (INAME)
       E3 = STOCK-SECTION-3 VIA (INAME)
       E4 = STOCK-SECTION-4 VIA (INAME)
       E5 = STOCK-SECTION-5 VIA (INAME)
       E6 = STOCK-SECTION-6 VIA (INAME)
       E7 = STOCK-SECTION-7 VIA (INAME)
       E8 = STOCK-SECTION-8 VIA (INAME)
       E9 = STOCK-SECTION-9 VIA (INAME)
       E10 = STOCK-SECTION-10 VIA (INAME)
       ENAME1 = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'C0', -
                TABLE-CODE = E1)
       ENAME2 = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'C1', -
                TABLE-CODE = E2)
       ENAME3 = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'C2', -
                TABLE-CODE = E3)
       ENAME4 = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'C3', -
                TABLE-CODE = E4)
       ENAME5 = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'C4', -
                TABLE-CODE = E5)
       ENAME6 = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'C5', -
                TABLE-CODE = E6)
       ENAME7 = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'C6', -
                TABLE-CODE = E7)
       ENAME8 = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'C7', -
                TABLE-CODE = E8)
       ENAME9 = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'C8', -
                TABLE-CODE = E9)
       ENAME10 = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'C9', -
                TABLE-CODE = E10)
       F = STOCK-QUAL VIA (ROPT)
       FNAME = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'QL', -
               TABLE-CODE = F)
%* Significant Dates
       ICDATE1 = CREATION-DATE VIA (ROPT)
       ICDATE = GET (DISPLAY-DATE FROM (ICDATE1))
       LCDATE1 = LAST-MOD-DATE VIA (ROPT)
       LCDATE = GET (DISPLAY-DATE FROM (LCDATE1))
%* Last Receipt Date
       TR-NOR = REVSD-TRAN-NO OF MSFX96A          -
                WHERE (STOCK-CODE-1  = STOCK-CODE,  -
                       DSTRCT-CODE-1 = DSTRCT-CODE, -
                       REC900-TYPE-1 >= SPACES)     -
                STOPIF   (STOCK-CODE-1  <> STOCK-CODE) -
                STOPIF   (DSTRCT-CODE-1 <> DSTRCT-CODE) -
                REJECTIF (REC900-TYPE-1 <> 'R') MAX (1)
       TR-DATER = REV-PROC-DATE VIA (TR-NOR)
       TR-DATEN = NUMERIC (TR-DATER) D-PIC (9(8))
       TR-DATE = CALC (99999999 - TR-DATEN) D-PIC (9(8))
       TR-IDN = NUMERIC (TR-NOR) D-PIC (9(11))
       TR-ID = CALC (99999999999 - TR-IDN) D-PIC (9(11))
       TR-USR = USERNO-1 VIA (TR-NOR)
       LRO = PO-NO-R OF MSF900 WHERE (DSTRCT-CODE = DSTRCT-CODE, -
             PROCESS-DATE = TR-DATE, TRANSACTION-NO = TR-ID, -
             USERNO = TR-USR, REC900-TYPE = 'R')
       LRDATE = CREATION-DATE VIA (LRO) FORMAT (DATE)
       LRS = SUPPLIER-NO-R VIA (LRO)
       LRQ = QTY-RCV-UOI-R VIA (LRO)
%* Last Issue Date
       TS-NOR = REVSD-TRAN-NO OF MSFX96A            -
                WHERE (STOCK-CODE-1  = STOCK-CODE,  -
                       DSTRCT-CODE-1 = DSTRCT-CODE, -
                       REC900-TYPE-1 >= SPACES)     -
                STOPIF (STOCK-CODE  <> STOCK-CODE) -
                STOPIF (DSTRCT-CODE <> DSTRCT-CODE) -
                SELECTIF (REC900-TYPE-1 = 'S') MAX (1)
       TS-DATER = REV-PROC-DATE VIA (TS-NOR)
       TS-DATEN = NUMERIC (TS-DATER) D-PIC (9(8))
       TS-DATE = CALC (99999999 - TS-DATEN) D-PIC (9(8))
       TS-IDN = NUMERIC (TS-NOR) D-PIC (9(11))
       TS-ID = CALC (99999999999 - TS-IDN) D-PIC (9(11))
       TS-USR = USERNO-1 VIA (TS-NOR)
       LIDATE = CREATION-DATE OF MSF900 WHERE (DSTRCT-CODE = DSTRCT-CODE, -
             PROCESS-DATE = TS-DATE, TRANSACTION-NO = TS-ID, -
             USERNO = TS-USR, REC900-TYPE = 'S') FORMAT (DATE)
       LIRQ = ISSUE-REQ-NO-S VIA (LIDATE)
       LIRS = AUTH-BY-S VIA (LIDATE)
       LIQ = QUANTITY-ISS-S VIA (LIDATE)
       LDATE = REVSD-CRT-DATE OF MSF221B WHERE (PREQ-STK-CODE = STOCK-CODE, -
                       REVSD-CRT-DATE >= SPACES) MAX (1)
       IRI221 = ISSUE-REQ        VIA (LDATE)
       LDT1 = NUMERIC (LDATE) I-PIC (9(8))
       LDT2 = CALC (99999999 - LDT1) I-PIC (9(8))
       LDT = GET (DISPLAY-DATE FROM (LDT2))
       LDO = PO-NO VIA (LDATE)
       EX = EXPEDITE-CODE VIA (LDATE)
       W1 = EXPEDITE-COUNT VIA (LDATE)
       LDOQ = ORIG-QTY-I VIA (LDATE)
       LDOSQ = QTY-RCV-OFST-I VIA (LDATE)
%* Order History
       OHPO = PO-NO OF MSF221B WHERE (PREQ-STK-CODE = STOCK-CODE, -
                                      REVSD-CRT-DATE >= SPACES) -
                               SELECTIF (PO-ITEM-TYPE = 'O') -
                               SELECTIF (PO-ITEM-TYPE = 'C') MAX (4)
       OHPOS = SIZE (OHPO)
       X = '/'
       G1 = PO-ITEM-NO VIA (OHPO)
       OHPC = PRICE-CODE VIA (OHPO)
       OHDATE = ORDER-DATE OF MSF220 WHERE (PO-NO = OHPO) FORMAT (DATE)
       OHPR = CURR-NET-PR-I VIA (OHPO)
       OHS = SUPPLIER-NO VIA (OHDATE)
       L8 = ' '
       L9 = '__________________________________________________________________'
       SL = ' '
       AL = ACT-LEAD-TIME VIA (OHPO)
%* Cross Referenced Stock Codes
       GSTK = STOCK-CODE-2 OF MSF171 WHERE (STOCK-CODE = STOCK-CODE, -
                   DSTRCT-CODE = SPACES, STOCK-CODE-2 >= SPACES) MAX (20)
       GINAME = ITEM-NAME OF MSF100 WHERE (STOCK-CODE = GSTK)
       H1 = STK-XREF-CODE VIA (GSTK)
       GXREF = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'XR', -
                       TABLE-CODE = H1)
%* 1 PART NO REQUIRED VIA MSS110 HOWEVER WILL BE DEFINED AS OCCURS 10
       GCOM = COMMENT-TXT VIA (GSTK)
       DSTK = STOCK-CODE-2 OF MSF171 WHERE (STOCK-CODE = STOCK-CODE, -
                   DSTRCT-CODE = DSTRCT-CODE, STOCK-CODE-2 >= SPACES) MAX (20)
       DINAME = ITEM-NAME OF MSF100 WHERE (STOCK-CODE = DSTK)
       J1 = STK-XREF-CODE VIA (DSTK)
       DXREF = TABLE-DESC OF MSF010 WHERE (TABLE-TYPE = 'XR', -
                       TABLE-CODE = J1)
%* 1 PART NO REQUIRED VIA MSS110 HOWEVER WILL BE DEFINED AS OCCURS 10
%*       DPART = '*******'
       DCOM = COMMENT-TXT VIA (DSTK)
%* Extra RO Information See EXTRO
%* Extended Stock Code description
%*
%* Version 008 Stock extended description has moved to MSF1CC
%*
       STKEXT = GET (READ-TEXT FROM ('MSF096') CODE ('SC') KEY (STOCK-CODE))
       STKSIZE = SIZE (STKEXT)
       TY = '|Type'
       STO = '|Stores'
%*
%*     MC16022013
%*
%*     NEXT 4 LINES GRABS THE WHOLE OF THE LARGE EXTENDED DESC FIELD
%*     FROM THE NEW MSF1CC TABLE
%*  
       STKEDESC = EXTENDED-DESC OF MSS1D1 -
                  WHERE (STOCK-CODE = STK, -
                           OPTION-1D1    = '2')
       STKEDESC1  = EXT-TEXT-1D1 VIA (STKEDESC)
%*
%*     MC16022013
%*
%*     NEXT 20 LINES SPLIT THE LARGE EXTENDED DESC FIELD
%*     OF STKEDESC1 UP INTO 20 ARRAYS OF 80 CHARS EACH 
%*      
%*     THIS WILL ALLOW FOR UP TO 40 LINES OF 40 CHARS EACH
%*     TO BE SHOWN ON THE PURCHASE ORDER OUTPUT
%* 
       STKED80NBR01 = SINGLE(STKEDESC1(1))
       STKED80NBR02 = SINGLE(STKEDESC1(2))
       STKED80NBR03 = SINGLE(STKEDESC1(3))
       STKED80NBR04 = SINGLE(STKEDESC1(4))
       STKED80NBR05 = SINGLE(STKEDESC1(5))
       STKED80NBR06 = SINGLE(STKEDESC1(6))
       STKED80NBR07 = SINGLE(STKEDESC1(7))
       STKED80NBR08 = SINGLE(STKEDESC1(8))
       STKED80NBR09 = SINGLE(STKEDESC1(9))
       STKED80NBR10 = SINGLE(STKEDESC1(10))
       STKED80NBR11 = SINGLE(STKEDESC1(11))
       STKED80NBR12 = SINGLE(STKEDESC1(12))
       STKED80NBR13 = SINGLE(STKEDESC1(13))
       STKED80NBR14 = SINGLE(STKEDESC1(14))
       STKED80NBR15 = SINGLE(STKEDESC1(15))
       STKED80NBR16 = SINGLE(STKEDESC1(16))
       STKED80NBR17 = SINGLE(STKEDESC1(17))
       STKED80NBR18 = SINGLE(STKEDESC1(18))
       STKED80NBR19 = SINGLE(STKEDESC1(19))
       STKED80NBR20 = SINGLE(STKEDESC1(20))
%*
%*     MC16022013
%*     NEXT 40 LINES SPLIT UP EACH OF THE 20 ARRAYS
%*     OF 80 CHARS EACH INTO 2 FIELDS, EACH OF 40 CHARS
%*      
%*     THIS WILL ALLOW FOR UP TO 40 LINES OF 40 CHARS EACH
%*     TO BE OUTPUT ON THE PURCHASE ORDER LINE
%* 
       STKED4001 = SUBSTR(STKED80NBR01,1,40)
       STKED4002 = SUBSTR(STKED80NBR01,41,40)
       STKED4003 = SUBSTR(STKED80NBR02,1,40)
       STKED4004 = SUBSTR(STKED80NBR02,41,40)
       STKED4005 = SUBSTR(STKED80NBR03,1,40)
       STKED4006 = SUBSTR(STKED80NBR03,41,40)
       STKED4007 = SUBSTR(STKED80NBR04,1,40)
       STKED4008 = SUBSTR(STKED80NBR04,41,40)
       STKED4009 = SUBSTR(STKED80NBR05,1,40)
       STKED4010 = SUBSTR(STKED80NBR05,41,40)
       STKED4011 = SUBSTR(STKED80NBR06,1,40)
       STKED4012 = SUBSTR(STKED80NBR06,41,40)
       STKED4013 = SUBSTR(STKED80NBR07,1,40)
       STKED4014 = SUBSTR(STKED80NBR07,41,40)
       STKED4015 = SUBSTR(STKED80NBR08,1,40)
       STKED4016 = SUBSTR(STKED80NBR08,41,40)
       STKED4017 = SUBSTR(STKED80NBR09,1,40)
       STKED4018 = SUBSTR(STKED80NBR09,41,40)
       STKED4019 = SUBSTR(STKED80NBR10,1,40)
       STKED4020 = SUBSTR(STKED80NBR10,41,40)
       STKED4021 = SUBSTR(STKED80NBR11,1,40)
       STKED4022 = SUBSTR(STKED80NBR11,41,40)
       STKED4023 = SUBSTR(STKED80NBR12,1,40)
       STKED4024 = SUBSTR(STKED80NBR12,41,40)
       STKED4025 = SUBSTR(STKED80NBR13,1,40)
       STKED4026 = SUBSTR(STKED80NBR13,41,40)
       STKED4027 = SUBSTR(STKED80NBR14,1,40)
       STKED4028 = SUBSTR(STKED80NBR14,41,40)
       STKED4029 = SUBSTR(STKED80NBR15,1,40)
       STKED4030 = SUBSTR(STKED80NBR15,41,40)
       STKED4031 = SUBSTR(STKED80NBR16,1,40)
       STKED4032 = SUBSTR(STKED80NBR16,41,40)
       STKED4033 = SUBSTR(STKED80NBR17,1,40)
       STKED4034 = SUBSTR(STKED80NBR17,41,40)
       STKED4035 = SUBSTR(STKED80NBR18,1,40)
       STKED4036 = SUBSTR(STKED80NBR18,41,40)
       STKED4037 = SUBSTR(STKED80NBR19,1,40)
       STKED4038 = SUBSTR(STKED80NBR19,41,40)
       STKED4039 = SUBSTR(STKED80NBR20,1,40)
       STKED4040 = SUBSTR(STKED80NBR20,41,40)
%* 
%* Version 008 end
%*
%* Supplier/Item Global and District Commentary
%*
       SUPGLOB = GET (READ-TEXT FROM ('MSF096') CODE ('CS') TYPE ('PC') -
                      SUPPLIER-VALUE (SUP))
       SZSUPG = SIZE (SUPGLOB)
       SUPDST = GET (READ-TEXT FROM ('MSF096') CODE ('CS') TYPE ('PC') -
                      DISTRICT-VALUE (%DISTRICT-CODE%) SUPPLIER-VALUE (SUP))
       SZSUPD = SIZE (SUPDST)
       STKGLOB = GET (READ-TEXT FROM ('MSF096') CODE ('CS') TYPE ('PC') -
                      STOCK-CODE-VALUE (STK))
       SZSTG = SIZE (STKGLOB)
       STKDST = GET (READ-TEXT FROM ('MSF096') CODE ('CS') TYPE ('PC') -
                      DISTRICT-VALUE (%DISTRICT-CODE%) STOCK-CODE-VALUE (STK))
       SZSTD = SIZE (STKDST)
       SUPSTKGL = GET (READ-TEXT FROM ('MSF096') CODE ('CS') TYPE ('PC') -
                      SUPPLIER-VALUE (SUP) STOCK-CODE-VALUE (STK))
       SZSSG = SIZE (SUPSTKGL)
       SUPSTKDST = GET (READ-TEXT FROM ('MSF096') CODE ('CS') TYPE ('PC') -
                      DISTRICT-VALUE (%DISTRICT-CODE%) SUPPLIER-VALUE (SUP) -
                      STOCK-CODE-VALUE (STK))
       SZSSD = SIZE (SUPSTKDST)
%*
%*     all rec order commentary GLOBAL (AS) , DISTRICT (AR)
%*
       SUPGLOB1 = GET (READ-TEXT FROM ('MSF096') CODE ('CS') TYPE ('AS') -
                      SUPPLIER-VALUE (SUP))
       SZSUPG1 = SIZE (SUPGLOB1)
       SUPDST1 = GET (READ-TEXT FROM ('MSF096') CODE ('CS') TYPE ('AR') -
                      DISTRICT-VALUE (%DISTRICT-CODE%) SUPPLIER-VALUE (SUP))
       SZSUPD1 = SIZE (SUPDST1)
       STKGLOB1 = GET (READ-TEXT FROM ('MSF096') CODE ('CS') TYPE ('AS') -
                      STOCK-CODE-VALUE (STK))
       SZSTG1 = SIZE (STKGLOB1)
       STKDST1 = GET (READ-TEXT FROM ('MSF096') CODE ('CS') TYPE ('AR') -
                      DISTRICT-VALUE (%DISTRICT-CODE%) STOCK-CODE-VALUE (STK))
       SZSTD1 = SIZE (STKDST1)
       SUPSTKGL1 = GET (READ-TEXT FROM ('MSF096') CODE ('CS') TYPE ('AS') -
                      SUPPLIER-VALUE (SUP) STOCK-CODE-VALUE (STK))
       SZSSG1 = SIZE (SUPSTKGL1)
       SUPSTKDST1 = GET (READ-TEXT FROM ('MSF096') CODE ('CS') TYPE ('AR') -
                      DISTRICT-VALUE (%DISTRICT-CODE%) SUPPLIER-VALUE (SUP) -
                      STOCK-CODE-VALUE (STK))
       SZSSD1 = SIZE (SUPSTKDST1)
