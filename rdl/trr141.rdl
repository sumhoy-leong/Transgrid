%*** TRR141.rdl
%***
%*** Copyright (c) 1998, Mincom Pty Ltd, Brisbane 4120, Australia.
%*** All rights reserved.
%***
%*** Generated by version 2.000i of ReportLink on 22-Jun-1998 at 18:42:26
%***
%*** Generated for version 3.043C of MIMS
%***
%*** REVISON HISTORY
%*** 24-May-13  EFredeluces SC4269165
%*** .....................  Fix the sorting order
%*** 13-May-13  a9wp3261    Version 0008
%*** .....................  Removed qty reactivation from calculation.
%*** 30-Apr-13  a9nl6176    Version 0007
%*** .....................  Fixed the way to print GL-ACCOUNT
%*** 09-Apr-13  a9nl6176    Version 0006
%*** .....................  Corrected the way to determine status
%*** .....................  by removing CATEG-MGT-FLG. Add SUPPRESS to some variables.
%*** 09-Apr-13  a9nl6176    Version 0005
%*** .....................  Corrected the IF condition for Good Holding Check
%*** .....................  Removed report B
%*** 27-Mar-13  a9nh4814    Version 0004
%*** .....................  Corrected MSL warning logic
%*** .....................  Corrected reservation pick slip displaying
%*** .....................  Corrected report A heading
%*** 28-Feb-13  a9ma2656    Modified printing logic of Bin Locations
%*** .....................  to use original whouse id when the receiving
%*** .....................  whouse is blank.
%*** 26-Feb-13  a9ma2656    Modified printing Reservation Picking Slips 
%*** .....................  text logic to ensure it is printed only when it 
%*** .....................  has picking slips details.
%*** 30-Nov-12  a9ra4993    Add warning message for minimum stock code,
%*** .....................  hazardous stock code and capital work order.
%*** 14-Aug-12  a9tl3060    Convert from ellipse 6 to ellipse 8 
%***                        (Version 0001).
%*** 22-May-12  a9zr4751    Convert from ellipse 6 to ellipse 8.
%*** 15-Dec-10  G Presser   3065579                        (Version 0006)
%***                        Make each block of 'items' 11 lines long.
%*** 23-Apr-09  Janak Barar SC2274680  - When acquitted; statement still coming 
%***                        back to acquit.  The suggestion made by Mincom in
%***                        Work order(TR2069) comments that the statement be
%***                        printed only when stock is category managed.
%*** 23-Apr-08  Janak Barar SC1838259  - Needs to include status = 3 when SOH
%***                        greater than 0.                 
%*** 30-Jan-07  Janak Barar SC1352733  - Wrong status printed item-141-stat
%***                        is '9'.                         
%*** 12-Jul-06  DDiolaso    SC1136825  - Wrong status printed when stock on
%***                        hand is zero or negative
%***
%*** 18-Sep-02  RK Mahajan  WCHG006326 - Print 2 lines of Delivery Instructions.
%***                        Fixed the program structure as well.
%*** 01-Nov-01  EFredeluces W01       - Change calculation for Stock Available.
%*** 02-Oct-01  EFredeluces W01090787 - Include the Inventory Category.
%*** 24-Jan-01  RK Mahajan  W01010486 - Bug fix on B89 variable.
%*** 27-Oct-00  EFredeluces W00100171
%***                        Include Inventory Category.
%*** 26-Aug-99  DDIOLASO -  W99080552
%*** .....................  Bug fix on some picking slips not printing
%*** 16-Jul-99  DDIOLASO -  W99070213
%****.....................  A customised msr141 -
%****.....................  report layout as specified by the user
%*
%* Define Report Parameters
%*
%* Report Name               :  msr141
%*
%* Reports Produced          :  A
%*
%* Report Description        :  Ad-Hoc Report
%*
%* Parameters
%*     Parameter Number      :  1
%*     Row Number            :  1
%*     Description           :  
%*     Length                :  4
%*     Optional
%*
%*     Parameter Number      :  1
%*     Row Number            :  2
%*     Description           :  
%*     Length                :  4
%*     Optional
%*
%*     Parameter Number      :  1
%*     Row Number            :  3
%*     Description           :  
%*     Length                :  4
%*     Optional
%*
%*     Parameter Number      :  1
%*     Row Number            :  4
%*     Description           :  
%*     Length                :  4
%*     Optional
%*
%*     Parameter Number      :  1
%*     Row Number            :  5
%*     Description           :  
%*     Length                :  4
%*     Optional
%*
%*     Parameter Number      :  1
%*     Row Number            :  6
%*     Description           :  
%*     Length                :  4
%*     Optional
%*
%*     Parameter Number      :  1
%*     Row Number            :  7
%*     Description           :  
%*     Length                :  4
%*     Optional
%*
%*     Parameter Number      :  1
%*     Row Number            :  8
%*     Description           :  
%*     Length                :  4
%*     Optional
%*
%*     Parameter Number      :  1
%*     Row Number            :  9
%*     Description           :  
%*     Length                :  4
%*     Optional
%*
%*     Parameter Number      :  1
%*     Row Number            :  10
%*     Description           :  
%*     Length                :  4
%*     Optional
%*
%*     Parameter Number      :  1
%*     Row Number            :  11
%*     Description           :  
%*     Length                :  4
%*     Optional
%*
%*     Parameter Number      :  1
%*     Row Number            :  12
%*     Description           :  
%*     Length                :  4
%*     Optional
%*
%*
%* End Report Parameter Definition
%*
%*
%* Request Header
%*
%*     Description Line 1    :  
%*     Description Line 2    :  
%*     Override Program      :  
%*     Number of Requests    :  0
%*     Reverse Option        :  TRUE
%*     Start Option          :  TRUE
%*     District Code Option  :  FALSE
%*     Medium/Printer        :  TRUE
%*     Request Record        :  TRUE
%*     Number to Process     :  
%*
%* End Request Header
%*
%PROGRAM-ID
    TRR141
%AUTHOR
    Mincom PTY LTD
%NARRATIVE
    Picking Slip Print Program There are two types of Request.
    1. Requisition No and Warehouse - Read MSF141-AIX1 using Req No
    and W/H (all items for blank W/H).
    - Printer is determined from Warehouse Table file.
    - An overriding 'Grid Printer' may be used VIA Table Type 'GP' -
    On change of printer (test at warehouse level or grid change) -
    start new Picking Slip - includes Header record format - directed
    at new printer 2. Requisition No + Item + Warehouse - Read
    MSF141AIX1 using Req No + W/H + Item (ie. only one item to be
    printed) - Printer is determined as above  For both types the
    request can contain a printer which overrides a printer on the
    Warehouse Table file.
    Both types: if the Requisition (item) is a Stores Sale then an
    Invoice Number is optionally passed in the request.
    This wil
%MODULE
    3140
%VERSION
    0008
%FILES
    MFILE = MSF141A
    AFILE = MSF141B
    LFILE = MSF010
    LFILE = MSF000
    LFILE = MSF001
    LFILE = MSF100
    LFILE = MSF140
    LFILE = MSF170
    LFILE = MSF180
    LFILE = MSF183
    LFILE = MSF192
    LFILE = MSF221
    LFILE = MSF564A
    LFILE = MSF123
    LFILE = MSF12A
    LFILE = MSF500
    LFILE = MSF870
    LFILE = MSFX68
    LFILE = MSF600
    LFILE = MSF1CSA
    LFILE = MSF1HB
    LFILE = MSF232
    LFILE = MSF620
    AFILE = MSF010
    RFILE = TRR141A
%ROUTINES
    MSS232
    MSSDAT
    MSS110
    MSS190
    MSS1HD
    MSSSOH
%SELECTION
%*DD0899 Replaced SELECTIF (NO-PRINT-IND <> 'Y' AND WHOUSE-ID >= A02 AND WHOUSE-ID <= A03)
%*DD0899 by SELECTIF (WHOUSE-ID >= A02 AND WHOUSE-ID <= A03)
%*DD0899 Removed REJECTIF (NO-PRINT-IND = 'Y') from the second WHERE
%*DD0899 
<IF %REQ-ITEM-FROM% = SPACES OR %REQ-ITEM-FROM% = '0000'>
    WHERE (DSTRCT-CODE-2          = %REQ-DSTRCT%, -
           IREQ-NO-2              = %REQ-NO%, -
           ISS-DSTRCT-CDE        >= SPACES)
    SELECTIF (ISS-DSTRCT-CDE >= A00, -
              ISS-DSTRCT-CDE <= A01, -
              WHOUSE-ID >= A02, -
              WHOUSE-ID <= A03)
<ELSE>
    WHERE (DSTRCT-CODE-2          = %REQ-DSTRCT%, -
           IREQ-NO-2              = %REQ-NO%, -
           ISS-DSTRCT-CDE        >= SPACES)
    SELECTIF (ISS-DSTRCT-CDE >= A09, -
              ISS-DSTRCT-CDE <= A11, -
              WHOUSE-ID >= A02, -
              WHOUSE-ID <= A03, -
              IREQ-ITEM-2 >= %REQ-ITEM-FROM%, -
              IREQ-ITEM-2 <= A08)
<ENDIF>
%ORDER
    ASCENDING ISS-DSTRCT-CDE
    ASCENDING WHOUSE-ID
    ASCENDING IREQ-NO
%** ASCENDING A06 TEXT BIN
    ASCENDING A06
    ASCENDING IREQ-ITEM
    ASCENDING ISSUE-REQ VIA (PS)
%BREAK-FIELDS
%*DD0799 Inserted ireq-no, issue-req VIA (ps)
    ISS-DSTRCT-CDE
    WHOUSE-ID
    IREQ-NO
%*  A06
    IREQ-ITEM
    ISSUE-REQ VIA (PS)
%CONTROL
    DISTRICT-FIELD = ISS-DSTRCT-CDE 
%REPORT
    A
%TITLE
    'Ad-Hoc Report'
%PAGE HEADING
<IF NO-PRINT-IND = 'R'>
    <IF %RE-PRINT% ='R'>
                '**********'{B663                 }'********** =REACT.REPRINT='
    <ELSE>
                '**********'{B663                 }'********** ==REACTIVATED=='
    <ENDIF>
<ELSE>
    <IF %RE-PRINT% ='R'>
                '**********'{B663                 }'********** ====REPRINT===='
    <ELSE>
                '**********'{B663                 }'**********'
    <ENDIF>
<ENDIF>
{L1       } {B672}    'Tran Type'TT 'Date Required'{B674   }'Created'{B676   }
{L2                    }  {B667                                            }
{L3                    }  {B671                                            }
%* Only print warnings for iss reqs ie. not for transfers
%*DD0799 FROM ITYPE TO B662
<IF B662  = 'I'>
 <IF WARNA = 'Y'>
                         '*** WARNING : CHECK AUTHORISED OFFICERS AUTHORITY***'
 <ENDIF>
 <IF WARNR = 'Y'>
                         '*** WARNING : REQUESTED BY = AUTHORISED BY ***'
 <ENDIF>
 <IF WARNU = 'Y'>
                         '*** WARNING : REQUESTED BY NOT = USERID ***'
 <ENDIF>
<ENDIF>
                         '*'         {L4      }    {A26 }   'Priority'  {A2}
<SUPPRESS>
{B62                       } DDDD
<SUPPRESS>
{B69                       } DDDD
<SUPPRESS>
{B76                       } DDDD
<SUPPRESS>
{B83                       } DDDD
<IF B662 <> 'W'>
    <IF A91 <> 'X'>
{L5        }             'W/Order  Project   Equipment No.  Allocation %'
      <REPEAT>
        <SUPPRESS>
{A96                   }  {A93   } {A94   }  {A95       }       {A92 }
      <ENDREPEAT>
     <IF A40 = SPACES>
%* Only print warning for iss reqs ie. not for transfers
       <IF B662 = 'I'>
'******************************************************************************'
'*    WARNING : NO HEADER COST CENTRE - RING SYSTEM ADMIN BEFORE ACQUITTAL    *'
'******************************************************************************'
       <ENDIF>
     <ENDIF>
   <ENDIF>
<ENDIF>
<IF B677 <> SPACES>
{L6           }     {B677                                                     }
                    {B6771                                                    }
<ENDIF>
{L7               } {PINSTR                                                   }
  <REPEAT>
<SUPPRESS>
                    {PINSTR                                                   }
  <ENDREPEAT>
  <REPEAT>
<SUPPRESS>
                    {PINSTR1                                                  }
  <ENDREPEAT>
  <REPEAT>
<SUPPRESS>
                    {PINSTR2                                                  }
  <ENDREPEAT>
<IF B662 = 'W'>

{L10    }'Warehouse'{A6} {B87                                   }
<ELSE>
  <IF B662 = 'D'>

{L10    }'District' {B88}  {DNAME                                 }
         'Order No.'{B90 }H{B92}
  <ENDIF>
<ENDIF>
{UNDERLINE                                                                    }
    'Stock Code/Item Name DueOut  SOH    Part  Required/ Bin'       {LQP      }
{L8}'Part Numbers/APL WH  After After UOI Iss Available  Locations'  {LQA     } 
{UNDERLINE                                                                    }
%*DD0799 BREAK GRID    HEADING ON NEW-PAGE 
%*%BREAK A06     HEADING ON NEW-PAGE
%BREAK IREQ-NO HEADING ON NEW-PAGE RESET-PAGE-COUNT
%BREAK IREQ-ITEM HEADING TEST-PAGE (11)
%* {A9} {A69    }       UUU{DO  }{SO  } {B1} V  QQQQQQQQQ  {B94       }ZZZZZZZZZ
{A9} {A69    } {PS2 } UUUU{DO  }{SO  } {B1} V QQQQQQQQQ  {B94       }ZZZZZZZZZ
     {A73                                   }            {B94       }{QA     }
     {A74   }  {A75                         } {SOH    }  {B94       }
  <SUPPRESS>
     {A74   }  {A75                         }            {B94       }
  <SUPPRESS>
     {A74   }  {A75                         }            {B94       }
%*'    Invty Categ   ='CC   'Invty Categ SOH = ' {ISOH    }
<IF APL-NO <> SPACES>
    'EGI/Eq'{A81       }'Co'{B4}'Mo'GG'Seq'{B5}'Itm'{B6} {B94       }
<ENDIF>
%*DD0799 TN REPLACED BY B3
<IF B3 <> SPACES>
    'UN Trpt code  :'{B3} {TNDESC                                   }
<ENDIF>
<IF XREF = 'Y'>
    '*** Active Cross-Reference item ***'
<ENDIF>
    'Item Status   ='{STATUS                            }  {B94       }
<REPEAT>
                                                         {B94       }
<ENDREPEAT>
<IF B662 <> 'W'>
   <IF A38 = 'I'>
 {L5        }            'W/Order  Project   Equipment No.  Allocation %'
     <REPEAT>
        <SUPPRESS>
 {GLA                   } {A41   } {A42   }  {EQP       }      {A44 }
     <ENDREPEAT>
   <ENDIF>
<ENDIF>
<IF X60 = 'Y'>
 {L11          }   '______________________________'
  <REPEAT QLESS1>
                   '______________________________'
  <ENDREPEAT>
<ENDIF>
<IF B662 <> 'I'>
   <IF B662 = 'D'>
                                                   '-----------RECEIVING-------'
                                                    'W/H Bin Locations Quantity'
                                                     {A6} {C33       }
   <ELSE>
                                                       '-------RECEIVING-------'
                                                        'Bin Locations Quantity'
   <ENDIF>
   <REPEAT>
      <SUPPRESS>
                                                          {C33       }
   <ENDREPEAT>


<ENDIF>
<IF DCOMS > 0>
 {L9       }'dst pc'  {DCOM                                  }
   <REPEAT>
      <SUPPRESS>
                      {DCOM                                  }
   <ENDREPEAT>
<ENDIF>
<IF DCOM1S > 0>
 {L9       }'dst ps'  {DCOM1                                 }
   <REPEAT>
      <SUPPRESS>
                      {DCOM1                                 }
   <ENDREPEAT>
<ENDIF>
<IF GCOMS > 0>
 {L9       }'gbl pc'  {GCOM                                  }
   <REPEAT>
      <SUPPRESS>
                      {GCOM                                  }
   <ENDREPEAT>
<ENDIF>
<IF GCOM1S > 0>
 {L9       }'gbl ps'  {GCOM1                                 }
   <REPEAT>
      <SUPPRESS>
                      {GCOM1                                 }
   <ENDREPEAT>
<ENDIF>
<IF A18 > A19>
    '**** Reservation Picking Slips for above Item ****'
'P/Slip/Item QtyO/S Req by Date Cre Date Req Instructions'
<ENDIF>
%* DG The following break does not compile properly (even if in break-fields)
%BREAK ISSUE-REQ VIA (PS) HEADING TEST-PAGE (1)
<IF A18 > A19> 
{PS  } {PI}{QTYOS} {B31A } {A19   } {A18   } {A50                             }
<ENDIF>
%DETAIL TEST-PAGE (6)
%BREAK IREQ-ITEM FOOTING TEST-PAGE (1)
<IF B662 <> 'WH' AND B662 <> 'TR'>
<IF SEL = 'Y' AND SEL4 = 'Y'>
'                                                                       '
'WARNING - Minimum Stock Levels breached, contact Warehouse Manager prior to'
'issuing the Goods'
<ENDIF>
<IF SEL2 = 'Y' OR SEL3 = 'Y'>
'                                                                       '
'Items to be issued to Goods Holding, contact Warehouse Manager.'
<ENDIF>
<IF B2 <> SPACES AND CNT2 = 1>
'                                                                       '
'Hazardous Mat.:'{B2} {A79                                      }                             
                     '*******************************************'
'I acknowledge the above item is classified as a Hazardous Substance and'
'relevant Safety Data Sheets (SDS) may be obtained through Chemalert.'
'                                                                       '
'Signed: _____________________ '
<ENDIF>
<ENDIF>
'                                                                       '
     {UNDERLINE                                                               }
%PAGE FOOTING
<IF (B > 'C', B < 'D')>
{UNDERLINE                                                                    }
L'Binned By and Date  | Received By and Date| Returned By    S/No.     Date'  L
L                     L                     L              L       L          L
L                     L                     L              L       L  '/   / 'L
{UNDERLINE                                                                    }
<ELSE>
{UNDERLINE                                                                    }
L'Picked By and Date  | Issued By and Date  | Received By    S/No.     Date'  L
L                     L                     L              L       L          L
L                     L                     L              L       L  '/   / 'L
{UNDERLINE                                                                    }
<ENDIF>
%*%SUMMARY
%CONTROL
       PAGE-WIDTH = 80
       MULTI-REQUEST = 10
       TRIM-REPORT
       DYNAMIC-PRINTER
%******************************************************************************
%* BAYS & ERAR (Radio Frequency Flat Files - Make printer spaces (FROM REQUEST)
%* and let msf000 program printer allocations work out print destination.
%* (MSO001 option 8.)
%******************************************************************************
       DYNAMIC-PRINTER
%******************************************************************************
%REQUEST-PARAMETERS
    REQ-DSTRCT      PIC (X(4))  TEXT 
    REQ-NO          PIC (X(6))  TEXT 
    REQ-ITEM-FROM   PIC (X(4))  TEXT
    REQ-ITEM-TO     PIC (X(4))  TEXT
    REQ-ISS-DSTRCT  PIC (X(4))  TEXT 
    REQ-WH          PIC (X(4))  TEXT 
    PR-WHOUSE       PIC (X(4))  TEXT 
    RE-PRINT        PIC (X(1))  TEXT 
    EDI-CONFIRM     PIC (X(1))  TEXT 
    INV-NO          PIC (X(8))  TEXT 
    DEFPRIN LIKE PRINTER1 OF MSF080     TEXT 
    QTY-PRE         PIC (X(9))  TEXT 
    REQ-BY          PIC (X(30)) TEXT 
%VARIABLES
%*  JKB 6 line
%*  B08 = '------------RECEIVING-------'
%*  A28 = 'Rotation Req'
%*  A11 = 'Report:        TRR141A'
%*  B12 = 'Bin Locations  Quantity'
%*  B09 = 'W/H  Bin Locations  Quantity'
%*  B11 = '-------RECEIVING-------'
    A0  = page()
    A00 = choose (LOW-VALUES IF (%REQ-ISS-DSTRCT% = SPACES), -
                 %REQ-ISS-DSTRCT%)   I-PIC (X(4)) CONSTANT
%*  JKB 1 line
%*  A08 = substr(%REQ-BY%, 1, 8)
    L   = '|'                        CONSTANT
    L1  = 'Requisition'              CONSTANT
    L2  = 'Authority Level/Req.  By' CONSTANT
    L3  = 'Authority Level/Auth. By' CONSTANT
    L4  = 'Rel. P/Req'               CONSTANT
    L5  = 'Cost Account'             CONSTANT
    L6  = 'Delivery Instr.'          CONSTANT
    L7  = 'Picking Slip Instr.'      CONSTANT
    L8  = 'Item'                     CONSTANT
    L9  = 'Commentary:'              CONSTANT
    L10 = 'Receiving'                CONSTANT
    L11 = 'Serial Numbers:'          CONSTANT
    A07 = 'Req.By:'                  CONSTANT
    A10 = 'Run On:'                  CONSTANT
%*  JKB 1 line
%*  A53 = 'Picking Slip/Delivery Instr.'  CONSTANT
    A12 = catenate (WX-SYSTEM-VERSION , '.' ,WX-RELEASE-VERSION) I-PIC (X(8))
    A01 = choose (HIGH-VALUES IF (%REQ-ISS-DSTRCT% = SPACES), -
                  %REQ-ISS-DSTRCT%)  I-PIC (X(4)) CONSTANT
    A02 = choose (LOW-VALUES IF (%REQ-WH% = SPACES), -
                  %REQ-WH%)          I-PIC (X(4)) CONSTANT
    A09 = choose (LOW-VALUES IF (%REQ-ISS-DSTRCT% = SPACES), -
                  %REQ-ISS-DSTRCT%)  I-PIC (X(4)) CONSTANT
%*  JKB 4 line
%*  K   = 'P'                        CONSTANT
%*  A16 = 'Req. Reference'           CONSTANT
%*  A57 = 'Customer No.'             CONSTANT
%*  A   = '/'                        CONSTANT
    A03 = choose (HIGH-VALUES IF (%REQ-WH% = SPACES), -
                  %REQ-WH%)          I-PIC (X(4)) CONSTANT
    A11 = choose (HIGH-VALUES IF (%REQ-ISS-DSTRCT% = SPACES), -
                  %REQ-ISS-DSTRCT%)  I-PIC (X(4)) CONSTANT
%*  JKB 1 line
%*  B17 = 'Comment(D):'              CONSTANT
    H   = '|'                        CONSTANT
%*  JKB 3 line
%*  A20 = 'Requested By '            CONSTANT
%*  I   = ','                        CONSTANT
%*  A46 = 'Loan Duration'            CONSTANT
%*  JKB 7 line
%*  A56 = choose ('N' IF (%INV-NO% <> SPACES), -
%*                'Y')               CONSTANT
%*  B85 = choose ('Current Invoice(s)' IF (A56 = 'Y'), -
%*                'Invoice No.')
%*  A63 = 'Receiving'                CONSTANT
%*  A25 = 'Related P/Req'            CONSTANT
%*  B21 = 'Comment(G):'              CONSTANT
    B01 = numeric (%QTY-PRE%)        I-PIC (9(9)) CONSTANT
%*  JKB 3 line
%*  A8  = 'Item'                     CONSTANT
%*  A23 = 'Authorised By'            CONSTANT
%*  A39 = 'Cost Account'             CONSTANT
    A81 = EQUIP-GRP-ID
    G   = COMP-MOD-CODE
    B4  = COMP-CODE
    B90 = PO-NO
    B5  = APL-SEQ-NO
    B6  = APL-ITEM-NO
%*  JKB 2 line
%*  F   = PART-ISSUE
%*  B26 = BIN-CODE
    B0  = WHOUSE-ID
    A69 = STOCK-CODE
    PS2 = IREQ-NO
    A9  = IREQ-ITEM
    C31 = QTY-REACTIV
    B24 = STOCK-CODE
    C   = INVENT-CAT
%*  JKB 9 line
%*  B70 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'IRC3') CONSTANT
%*  B80 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'ICR4') CONSTANT
%*  B58 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'ILN1') CONSTANT
%*  JKB 9 line
%*  B64 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'ISS2') CONSTANT
%*  B65 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'ILN2') CONSTANT
%*  B71 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'ISS3') CONSTANT
    B76 = TABLE-DESC OF MSF010 -
          WHERE (TABLE-TYPE = 'XX', -
                 TABLE-CODE = 'I3')   CONSTANT
    B83 = TABLE-DESC OF MSF010 -
          WHERE (TABLE-TYPE = 'XX', -
                 TABLE-CODE = 'I4')   CONSTANT
%*  JKB 9 line
%*  B75 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'IRT3') CONSTANT
%*  B61 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'IRT1') CONSTANT
%*  B67 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'IDI2') CONSTANT
    B69 = TABLE-DESC OF MSF010 -
          WHERE (TABLE-TYPE = 'XX', -
                 TABLE-CODE = 'I2')   CONSTANT
%*  JKB 9 line
%*  B74 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'IDI3') CONSTANT
%*  B82 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'IRT4') CONSTANT
%*  B73 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'ICR3') CONSTANT
%*  JKB 9 line
%*  B78 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'ISS4') CONSTANT
%*  B59 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'ICR1') CONSTANT
%*  B57 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'ISS1') CONSTANT
%*  JKB 9 line
%*  B72 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'ILN3') CONSTANT
%*  B68 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'IRT2') CONSTANT
%*  B63 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'IRC2') CONSTANT
%*  JKB 9 line
%*  B79 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'ILN4') CONSTANT
%*  B60 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'IDI1') CONSTANT
%*  B77 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'IRC4') CONSTANT
%*  JKB 6 line
%*  B81 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'IDI4') CONSTANT
%*  B56 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'IRC1') CONSTANT
    B62 = TABLE-DESC OF MSF010 -
          WHERE (TABLE-TYPE = 'XX', -
                 TABLE-CODE = 'I1')   CONSTANT
%*  JKB 9 lines
%*  B66 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'XX', -
%*               TABLE-CODE = 'ICR2') CONSTANT
%*  A51 = get (READ-TEXT FROM ('MSF096') -
%*             CODE ('PS') -
%*             KEY(%REQ-DSTRCT% ,IREQ-NO)) -
%*        MAX(20) TEXT-WIDTH(60)
%*  A52 = size (A51)
%*  J   = substr (IREQ-ITEM, 2, 3)
    B92 = PO-ITEM-NO
    B03 = choose (C31 IF (NO-PRINT-IND <> 'R'), -
                  C31 IF (%REQ-ITEM-FROM% = SPACES), -
                  C31 IF (%REQ-ITEM-FROM% = '0000'), -
                  C31 IF (B01 = ZERO), -
                  B01)
    B02 = CALC (QTY-ISSUED + QTY-ISSUED-CON) 
    A70 = CALC (QTY-REQ - B02 + B03) 
%*  JKB 6 lines
%*  B25 = CALC (QTY-REQ - B02 + B03) D-PIC (99999999)
%*  B05 = CALC (A70 * - 1 - 1) 
%*  B04 = CALC (A70 - 1) 
%*  B06 = choose (B04 IF (A70 > 0), -
%*                B05 IF (A70 < 0), -
%*                0)
%*
    B660 = IREQ-NO OF MSF140 -
           WHERE (DSTRCT-CODE = DSTRCT-CODE, -
                  IREQ-NO     = IREQ-NO)
    B661 = ISS-TRAN-TYPE             VIA (B660)
%* Create new variable for ISS-TRAN-TYPE to reduce spaces in layout
    T    = ISS-TRAN-TYPE             VIA (B660)
    B662 = IREQ-TYPE                 VIA (B660)
%*
%* Other reservation picking slips for this item
    PS   = IREQ-NO FROM MSF141B -
           WHERE    (ISS-DSTRCT-CDE-2 >= SPACES) -
           REJECTIF (STOCK-CODE       <> STOCK-CODE) -
           REJECTIF (DSTRCT-CODE-3    <> %DISTRICT-CODE%) -
           SELECTIF (ITEM-141-STAT     < '9', IREQ-NO <> B660) -
           MAX (20)
%*dd0899 from A to B660
%*  JKB 1 line
%*  PIS    = ISSUE-REQ               VIA (PS)
    PI     = IREQ-ITEM               VIA (PS)
    QTYREQ = QTY-REQ                 VIA (PS)
    QTYISS = QTY-ISSUED              VIA (PS)
    QTYOS  = CALC (QTYREQ - QTYISS)  D-PIC (ZZZZZZZZ)

    B34 = USE-BY-DATE OF MSF140 -
          WHERE (DSTRCT-CODE = DSTRCT-CODE, -
                 IREQ-NO     = PS)
    B32 = REQ-BY-POS                 VIA (B34)
    B43 = AUTHSD-BY                  VIA (B34)
%*  JKB 1 line
%*  A3  = OTHER-ANSWERS              VIA (B34)
    A2  = PRIORITY-CODE              VIA (B34)
    A26 = PREQ-NO                    VIA (B34)
%*  JKB 4 line
%*  A29 = ROTN-REQ-NO                VIA (B34)
%*  A4  = DELIV-LOCATION             VIA (B34)
%*  A1  = DSTRCT-CODE                VIA (B34)
%*  A17 = IREQ-NO                    VIA (B34)
    A19 = CREATION-DATE              VIA (B34) FORMAT DATE
    B   = ISS-TRAN-TYPE              VIA (B34)
    A18 = REQ-BY-DATE                VIA (B34) FORMAT DATE
%*  JKB 1 line
%*  RDATE = get (DISPLAY-DATE FROM (A18))
    A6RW = RCVNG-WHOUSE              VIA (B34)
    A6OW = ORIG-WHOUSE-ID            VIA (B34)
    A6   = CHOOSE (A6RW IF (A6RW <> SPACES), A6OW)
    A37 = IREQ-TYPE                  VIA (B34)
    A50 = DELIV-INSTR-A              VIA (B34)
%*  JKB 2 line
%*  A49 = LOAN-REQ-NO                VIA (B34)
%*  A5  = LOAN-DURATION-9            VIA (B34) D-PIC (ZZZ9)
    B91 = NUM-OF-ITEMS-9             VIA (B34)
%*  JKB 2 line
%*  A54 = DELIV-INSTR-B              VIA (B34)
%*  A55 = CUST-NO                    VIA (B34)
    B31 = REQUESTED-BY               VIA (B34)
    B31A = substr(B31,4,7)           D-PIC (X(7))
%*  JKB 1 line
%*  A45 = LOAN-DURATION-9            VIA (B34)
%*DD150799 end of insert
    B53 = GRID-size OF MSF000 -
          WHERE (DSTRCT-CODE      = ISS-DSTRCT-CDE, -
                 CONTROL-REC-TYPE = 'DC', -
                 CONTROL-REC-NO   = '0002')
    C44 = LARGE-VOL-PRT OF MSF001 -
          WHERE (DSTRCT-CODE    = ISS-DSTRCT-CDE, -
                 CTL-REC-TYPE   = 'WC', -
                 CONTROL-REC-NO = WHOUSE-ID)
    C42 = XFER-SLIP-PRT              VIA (C44)
    C48 = REACT-SLIP-PRT             VIA (C44)
    C46 = RECALL-SLIP-PRT            VIA (C44)
    C04 = STOR-MGT-FLG               VIA (C44)
    C40 = PICK-SLIP-PRT              VIA (C44)
%*  JKB 8 line
%*  B29 = TRACK-NO OF MSF192 -
%*        WHERE (DSTRCT-CODE = ISS-DSTRCT-CDE, -
%*               STOCK-CODE  = STOCK-CODE, -
%*               WHOUSE-ID   = WHOUSE-ID, -
%*               TYPE-192    = 'R', -
%*               BIN-CODE   >= IREQ-NO & '  ' & IREQ-ITEM, -
%*               BIN-CODE   <= IREQ-NO & '  ' & IREQ-ITEM) -
%*        MAX(30)
    A75 = PART-NO OF MSS110 -
          WHERE (DSTRCT-CODE   = ISS-DSTRCT-CDE, -
                 STOCK-CODE    = STOCK-CODE, -
                 NO-REQUIRED-9 = 3)
    A74 = MNEMONIC VIA (A75)
    B40 = CATEG-MGT-FLG OF MSF170 -
          WHERE (DSTRCT-CODE  = ISS-DSTRCT-CDE, -
                 STOCK-CODE   = STOCK-CODE)  

%*  B40 = CATEG-MGT-FLG OF MSF170 -
%*        WHERE (DSTRCT-CODE  = ISS-DSTRCT-CDE, -
%*               STOCK-CODE >= SPACES) -
%*        REJECTIF (STOCK-CODE <> STOCK-CODE) -                                  
%*        SELECTIF (CATEG-MGT-FLG = 'Y') -                                       
%*        MAX(1)

%*  A97 = EQUIP-TRACE-IND            VIA (B40)

    X68 = EQUIP-NO OF MSFX68 -
          WHERE (STOCK-CODE       = STOCK-CODE, -
                 EQUIP-NO        >= SPACES) -
          MAX (1)

    X60 = TRACEABLE-FLG OF MSF600 -
          WHERE (EQUIP-NO = X68)

%*DD0799 
    SO  = DSTRCT-OWN-SOH OF MSSSOH -
    WHERE (OPTION-SOH             = '1',-                                        
           DSTRCT-CODE            = ISS-DSTRCT-CDE, -                                 
           STOCK-CODE             = STOCK-CODE, -                                     
           DSTRCT-SOH-REQ-SW      = 'Y')                                        
%*  SO  = SOH                        VIA (B40)                                        
    CUS1= CUSTODIAN-ID OF MSF1CSA -
    WHERE (DSTRCT-CODE            = ISS-DSTRCT-CDE, -
           WHOUSE-ID             >= WHOUSE-ID, -
           WHOUSE-ID             <= WHOUSE-ID) -
    MAX(1)
    B94 = BIN-CODE OF MSF1HB -
    WHERE (CUSTODIAN-ID          = CUS1, -
           STOCK-CODE            = STOCK-CODE, -
           BIN-CODE             >= SPACES) -
    MAX(30)
    C35 = PRIME-LOCATION             VIA (B94)
    A92 = ALLOC-PC OF MSS232 -
          WHERE (OPTION-232   = 'R', -
                 DSTRCT-CODE  = DSTRCT-CODE, -
                 REQ-TYPE-IND = 'I', -
                 REQ-NO       = IREQ-NO, -
                 IREQ-ITEM    = '0000') D-PIC ( ZZ9.99 BLANK WHEN ZERO )
    A94 = PROJECT-NO                 VIA (A92)
    A95 = EQUIP-NO                   VIA (A92)
    A91 = RETURN-STATUS              VIA (A92)
    A96 = GL-ACCOUNT                 VIA (A92)
    A93 = WORK-ORDER                 VIA (A92)
    EQP = EQUIP-NO OF MSS232 -
          WHERE (OPTION-232   = 'R', -
                 DSTRCT-CODE  = DSTRCT-CODE, -
                 REQ-TYPE-IND = 'I', -
                 REQ-NO       = IREQ-NO, -
                 IREQ-ITEM    = IREQ-ITEM)
%*  JKB 3 line
    GLA = GL-ACCOUNT                 VIA (EQP)
    A44 = ALLOC-PC                   VIA (EQP) ( ZZ9.99 BLANK WHEN ZERO )
    A42 = PROJECT-NO                 VIA (EQP)
    A38 = RETURN-STATUS              VIA (EQP)
%*  JKB 1 line
    A41 = WORK-ORDER                 VIA (EQP)
    A40 = single (GLA(1))
    B41 = BATCH-LOT-MGT-IND OF MSF180 -
          WHERE (DSTRCT-CODE = ISS-DSTRCT-CDE, -
                 STOCK-CODE  = STOCK-CODE, -
                 WHOUSE-ID   = WHOUSE-ID)
    C50 = WHOUSE-ID                  VIA (B41)
    B42 = SHELF-LIFE                 VIA (B41)
%*  JKB 8 line
%*  B30 = TRACK-NO OF MSF192 -
%*        WHERE (DSTRCT-CODE = ISS-DSTRCT-CDE, -
%*               STOCK-CODE  = STOCK-CODE, -
%*               WHOUSE-ID   = WHOUSE-ID, -
%*               TYPE-192    = 'E', -
%*               BIN-CODE   >= IREQ-NO & '  ' & IREQ-ITEM, -
%*               BIN-CODE   <= IREQ-NO & '  ' & IREQ-ITEM) -
%*        MAX(30)
    A78 = HAZARD-MAT OF MSF100 -
          WHERE (STOCK-CODE = STOCK-CODE)
    B1  = UNIT-OF-ISSUE              VIA (A78)
%*  A98 = TRACKING-IND               VIA (A78)
    B3  = UN-TRANSP-CODE             VIA (A78)
    B2  = HAZARD-MAT                 VIA (A78)
%*  A80 = UN-TRANSP-CODE             VIA (A78)
    C43 = LARGE-VOL-PRT OF MSF001 -
          WHERE (DSTRCT-CODE    = ISS-DSTRCT-CDE, -
                 CTL-REC-TYPE   = 'WC', -
                 CONTROL-REC-NO = %PR-WHOUSE%)
    C45 = RECALL-SLIP-PRT            VIA (C43)
    C47 = REACT-SLIP-PRT             VIA (C43)
    C41 = XFER-SLIP-PRT              VIA (C43)
    C39 = PICK-SLIP-PRT              VIA (C43)
    B88 = DSTRCT-CODE OF MSF221 -
          WHERE (PO-NO      = PO-NO, -
                 PO-ITEM-NO = PO-ITEM-NO) -
                IF (A37 = 'D')
%*DD150799
    DTX = choose (%DISTRICT-CODE% IF (A37 <> 'D'), -
                  %DISTRICT-CODE% IF (B88 = SPACES), -
                  B88)
    DNAME = get (DISTRICT-NAME FROM ('MSS002') DISTRICT (DTX))
%*  JKB 5 lines   
%*  B86 = AR-INV-NO OF MSF564A -
%*        WHERE (DSTRCT-CODE-2 = DSTRCT-CODE, -
%*               IREQ-NO      <= IREQ-NO, -
%*               IREQ-NO      >= IREQ-NO) -
%*        MAX(18)
    C49 = ISS-PRE-POSTED OF MSF000 -
          WHERE (DSTRCT-CODE = ISS-DSTRCT-CDE, -
                 CONTROL-REC-TYPE = 'DC', -
                 CONTROL-REC-NO   = '0001')
%*  JKB 1 line
%*  A09 = DSTRCT-NAME               VIA (C49)
    A7  = DSTRCT-CODE               VIA (B88) IF (A37 = 'TR') 
    A15 = choose ('S' IF (A37 = 'SC'), -
                  'S' IF (A37 = 'SR'), -
                  'S' IF (A37 = 'SS'), -
                  SPACES)
%*  JKB 2 line
%*  B93 = choose (C49 IF (A15 <> 'S'), -
%*                'A')
%*  JKB 2 line
%*  A48 = choose ('Loan Requisition No' IF (A49 <> SPACES), -
%*                SPACES)
%*  JKB 12 line
%*  A14 = choose (' ROTATION ISSUE REQUISITION' IF (A37 = 'TI'), -
%*                '      LOAN REQUISITION     ' IF (A37 = 'LN'), -
%*                '         LOAN RETURN       ' IF (A37 = 'LR'), -
%*                '     RECALL REQUISITION    ' IF (A37 = 'RC'), -
%*                '   WAREHOUSE TRANSFER REQ. ' IF (A37 = 'WH'), -
%*                '    DISTRICT TRANSFER REQ. ' IF (A37 = 'TR'), -
%*                '     DISPOSAL REQUISITION  ' IF (A37 = 'DI'), -
%*                '     CREDIT REQUISITION    ' IF (A37 = 'CR'), -
%*                'ROTATION CREDIT REQUISITION' IF (A37 = 'TC'), -
%*                'ROTATION CREDIT REQUISITION' IF (A37 = 'TL'), -
%*                '   WAREHOUSE REQUISITION   ')
%*  B33 = numeric (A18)             I-PIC (9(8))
    A04 = numeric (B53)             I-PIC (9(2))
    A05 = substr (BIN-CODE, 1, A04)
%*    A06 = choose (A05 IF (A04 > 0), -
%*                   ' ')
    A06 = BIN-CODE 
    B37 = single (C35 (1))
    B36 = single (B94 (1))
    B38 = choose (B36 IF (B37 = '1'), -
                  SPACES)
%*  JKB 16 lines        
%*  E   = choose (B92 IF (A37 = 'TR' AND (B91 = 1)), -
%*                SPACES)
%*  A27 = choose (B56 IF (A37 = 'RC'), -
%*                B57 IF (A37 = 'SC'), -
%*                B57 IF (A37 = 'SR'), -
%*                B57 IF (A37 = 'SS'), -
%*                B58 IF (A37 = 'LN'), -
%*                B58 IF (A37 = 'LR'), -
%*                B59 IF (A37 = 'CR'), -
%*                B60 IF (A37 = 'DI'), -
%*                B61 IF (A37 = 'TI'), -
%*                B61 IF (A37 = 'TC'), -
%*                B61 IF (A37 = 'TL'), -
%*                B62)
%*  A22 = choose (SPACES IF (C = SPACES), -
%*                'Invent Cat')
%*  JKB 12 lines        
%*  A30 = choose (B63 IF (A37 = 'RC'), -
%*                B64 IF (A37 = 'SC'), -
%*                B64 IF (A37 = 'SR'), -
%*                B64 IF (A37 = 'SS'), -
%*                B65 IF (A37 = 'LN'), -
%*                B65 IF (A37 = 'LR'), -
%*                B66 IF (A37 = 'CR'), -
%*                B67 IF (A37 = 'DI'), -
%*                B68 IF (A37 = 'TI'), -
%*                B68 IF (A37 = 'TC'), -
%*                B68 IF (A37 = 'TL'), -
%*                B69)
%*  JKB 12 lines        
%*  A31 = choose (B70 IF (A37 = 'RC'), -
%*                B71 IF (A37 = 'SC'), -
%*                B71 IF (A37 = 'SR'), -
%*                B71 IF (A37 = 'SS'), -
%*                B72 IF (A37 = 'LN'), -
%*                B72 IF (A37 = 'LR'), -
%*                B73 IF (A37 = 'CR'), -
%*                B74 IF (A37 = 'DI'), -
%*                B75 IF (A37 = 'TI'), -
%*                B75 IF (A37 = 'TC'), -
%*                B75 IF (A37 = 'TL'), -
%*                B76)
%*  JKB 12 lines        
%*  A32 = choose (B77 IF (A37 = 'RC'), -
%*                B78 IF (A37 = 'SC'), -
%*                B78 IF (A37 = 'SR'), -
%*                B78 IF (A37 = 'SS'), -
%*                B79 IF (A37 = 'LN'), -
%*                B79 IF (A37 = 'LR'), -
%*                B80 IF (A37 = 'CR'), -
%*                B81 IF (A37 = 'DI'), -
%*                B82 IF (A37 = 'TI'), -
%*                B82 IF (A37 = 'TC'), -
%*                B82 IF (A37 = 'TL'), -
%*                B83)
    B46 = choose (C39 IF (%PR-WHOUSE% <> SPACES), -
                  C40)
    B47 = choose (C41 IF (%PR-WHOUSE% <> SPACES), -
                  C42)
    B48 = choose (C43 IF (%PR-WHOUSE% <> SPACES), -
                  C44)
    B49 = choose (C45 IF (%PR-WHOUSE% <> SPACES), -
                  C46)
    B50 = choose (C47 IF (%PR-WHOUSE% <> SPACES), -
                  C48)
    B96 = STOCK-AVAILABLE OF MSSSOH -
    WHERE (OPTION-SOH             = '2', -
           DSTRCT-CODE            = ISS-DSTRCT-CDE, -
           STOCK-CODE             = STOCK-CODE, -
           WHOUSE-ID              = WHOUSE-ID)
%* RKM 240101
    B89 = choose (%DISTRICT-CODE% IF (A37 <> 'TR'), -
                  %DISTRICT-CODE% IF (A7 = SPACES), -
                  A7)
%* RKM 240101
%* JKB 2 line
%*  A60 = choose (B85 IF (A15 = 'S'), -
%*                SPACES)
    A65 = get (DISTRICT-NAME FROM ('MSS002') DISTRICT(B89))
%* JKB 2 line
%*  A66 = choose (B90 IF (A37 = 'TR'), -
%*                SPACES)
%* JKB 2 line
%*  A33 = choose (SPACES IF (A4 = SPACES), -
%*                'Delivery Location')
    B95 = STOCK-AVAILABLE OF MSSSOH -
    WHERE (OPTION-SOH             = '1', -
           DSTRCT-CODE            = ISS-DSTRCT-CDE, -
           STOCK-CODE             = STOCK-CODE, -
           BYPASS-CAT-SEC-SW      = 'Y', -
           DSTRCT-SOH-REQ-SW      = 'Y')
%*DD150799 
    SOHA = B96
    DO  = DUES-OUT VIA (B95)
%* JKB 13 line
%*  A61 = choose (%INV-NO% IF (A15 = 'S'), -
%*                SPACES)            I-PIC (X(8))
%*  A62 = choose (B86 IF (A15 = 'S'), -
%*                SPACES)
%*  A99 = choose ('Serial Numbers:' IF (A97 = 'Y' OR A98 = 'S'), -
%*                'Equipment Numbers:' IF (A98 = 'E'), -
%*                SPACES)
%*  A36 = choose (SPACES IF (B34 = SPACES OR B34 = '00000000'), -
%*                B34)               FORMAT (DATE)
%*  A67 = choose (' Qty Picked' IF (B93 = 'N'), -
%*                'Qty to Pick')
%*  A35 = choose (SPACES IF (B34 = SPACES OR B34 = '00000000'), -
%*                'Use By Date')
    B98 = choose (B96 IF (C50 <> SPACES), -
                  B95)
    B99 = CALC (B98 + A70) 
    C00 = choose (B99 IF (B99 < A70), -
                  A70)
    C01 = choose (A70 IF ((B >= 'C0' AND B <= 'C9') OR -
                          (B >= 'CA' AND B <= 'CZ') OR -
                          (A37 = 'LR')), -
                  0 IF (C00 < 0), -
                  C00)
    C03 = choose (C01 IF (B03 = 0), -
                  0)
    C02 = choose (C01 IF (B03 = 0), -
                  B03)
%*DD    D   = choose ('/' IF (A37 = 'TR' AND (B91 = 1)), ' ')
%*  JKB 4 lines
%*  A77 = choose (C03 IF (B93 = 'Y'), -
%*                C01 IF (B93 = 'N'), -
%*                0)                 FORMAT (BLANK-WHEN-ZERO)
%*  A76 = CALC (B98 + 0) 
    A73 = get (PACKED-DESC FROM ('MSF100')) 
%*  JKB 6 lines
%*  A72 = choose (C02 IF (B93 = 'Y'), -
%*                0 IF (B93 = 'N'), -
%*                B03)               FORMAT (BLANK-WHEN-ZERO)
%*  A71 = PUT(B94) MAX (18)
%*  A68 = choose ('          ' IF (B93 = 'A'), -
%*                '/To Acquit')
%*  JKB 4 lines   
%*  C30 = TRACK-REF-NO OF MSF123 -
%*        WHERE (TRACK-TYPE  = A98, -
%*               TRACK-NO    = B29) -
%*        MAX(30)
%*  JKB 2 lines
%*  C51 = HRget (EMPLOYEE-ID from ('MSF810,MSSEMP') KEY (EMPLOYEE-ID = B43))
%*  A24 = FORMATTED-NAME             VIA (C51)
    A79 = TABLE-DESC OF MSF010 -
          WHERE (TABLE-TYPE = 'HZ', -
                 TABLE-CODE = A78)
%*  JKB 2 lines
%*  B55 = SUPP-CUST-NAME-1 OF MSF12A -
%*        WHERE (SUPPLY-CUST-ID = B31)
%*  JKB 2 lines
%*  C52 = HRget (EMPLOYEE-ID from ('MSSEMP,MSF810') KEY (EMPLOYEE-ID = B31))
%*  B54 = FORMATTED-NAME               VIA (C52)
%*
    B663 = choose ('WAREHOUSE TRANSFER REQ.' IF (B662 = 'W'), -
                   ' DISTRICT TRANSFER REQ.' IF (B662 = 'D'), -
                   'WAREHOUSE REQ==CREDIT==' IF (B661 > 'C', B661 < 'D'), -
                   ' WAREHOUSE REQUISITION ')
%*
%*  JKB 1 lines
    D    = OTHER-ANSWERS             VIA (B660)
    B664 = REQUESTED-BY              VIA (B660)
    B665 = AUTHSD-BY                 VIA (B660)
    B666 = HRget (EMPLOYEE-ID from ('MSSEMP,MSF810') KEY (EMPLOYEE-ID = B664))
    B667 = FORMATTED-NAME            VIA (B666)
    B668 = HRget (EMPLOYEE-ID from ('MSSEMP,MSF810') KEY (EMPLOYEE-ID = B665)
    B670 = FORMATTED-NAME            VIA (B668)
    B671 = choose (SPACES IF (B662 = 'D'), -
                   B670)
    GVAL1 = substr (B671, 1, 1) 
    B672  = IREQ-NO                  VIA (B660)
    B673  = REQ-BY-DATE              VIA (B660)
    B674  = get (DISPLAY-DATE FROM (B673))
    B675  = CREATION-DATE            VIA (B660)
    B676  = get (DISPLAY-DATE FROM (B675))
    B677  = DELIV-INSTR-A            VIA (B660)
    B6771 = DELIV-INSTR-B            VIA (B660)
%* DG Use req-by for react.& reprint p/slips because userid is blank or 
%*    the userid of the person doing the reprint on these requests.
   USERID = choose (B31 IF (NO-PRINT-IND = 'R'), -
                    B31 IF (%RE-PRINT%   = 'R'), -
                    %REQ-BY%)
%* DG Userid Flag - Flag if userid not = requestor or authorisor
%* DG Warning message if Auth code not = A,B,C,D or E.
    WARNA = choose ('N' IF (GVAL1 >= 'A', GVAL1 <= 'E'), -
                    'Y')
%* DG Warning message if Auth By = Req By.
    WARNR = choose ('N' IF (B31 <> B43), -
                    'Y')
%* DG Warning message if Req By code not = Userid.
    WARNU = choose ('N' IF (USERID = B31), 'Y')
%*  JKB 4 lines
%*  A47 = DISPLAY-DATE OF MSSDAT -
%*        WHERE (OPTION = '1', -
%*               DATE1  = B33, -
%*               DAYS   = A45)
%*  JKB 4 lines   
%*  C32 = TRACK-REF-NO OF MSF123 -
%*        WHERE (TRACK-TYPE = A98, -
%*               TRACK-NO   = B30) -
%*        MAX(30)
    C37 = ASSOC-CHAR-9 OF MSF010 -
          WHERE (TABLE-TYPE = 'GP', -
                 TABLE-CODE = ISS-DSTRCT-CDE & WHOUSE-ID & A06)
    C36 = PRINTER                    VIA (C37)
%*DD    PRINTDD = 'X0' CONSTANT
%*DD    C36 = PRINTER (PRINTDD)
    C38 = ASSOC-CHAR-10              VIA (C37)
    A13 = ASSOC-CHAR-13              VIA (C37)
%*  JKB 2 lines   
%*  B84 = DELIV-PHONE OF MSF500 -
%*        WHERE (CUST-NO = A55)
    B87 = TABLE-DESC OF MSF010 -
          WHERE (TABLE-TYPE = 'WH', -
                 TABLE-CODE = ISS-DSTRCT-CDE & A6) -
          IF (B662 = 'W') ELSE (SPACES)
    CUS2A= CUSTODIAN-ID OF MSF1CSA -
    WHERE (DSTRCT-CODE            = ISS-DSTRCT-CDE, -
           WHOUSE-ID             >= SPACES) -
    SELECTIF (WHOUSE-ID           = A6) -
    MAX(1)
    CUS2B= CUSTODIAN-ID OF MSF1CSA -
    WHERE (DSTRCT-CODE            = ISS-DSTRCT-CDE, -
           WHOUSE-ID             >= SPACES) -
    SELECTIF (WHOUSE-ID           = A6) -
    REJECTIF (CUSTODIAN-ID        = CUS2A) -
    MAX(1)
    C33A= BIN-CODE OF MSF1HB -
    WHERE (CUSTODIAN-ID          = CUS2A, -
           STOCK-CODE            = STOCK-CODE, -
           BIN-CODE             >= SPACES) -
    MAX(1)
    CUS2= CHOOSE (CUS2A IF(C33A <> SPACES), CUS2B)
    C33 = BIN-CODE OF MSF1HB -
    WHERE (CUSTODIAN-ID          = CUS2, -
           STOCK-CODE            = STOCK-CODE, -
           BIN-CODE             >= SPACES) -
    MAX(18)

%*
%*  JKB 3 lines
%*  A34 = TABLE-DESC OF MSF010 -
%*        WHERE (TABLE-TYPE = 'DN', -
%*               TABLE-CODE = A4)
    B35 = CAT-MATCH-VAL OF MSF870 -
          WHERE (POSITION-ID = B32)
%*  JKB 8 lines
%*  B27 = choose (1 IF (A13 = 'Y'), -
%*  B28 = TOTAL (B27)
%*  A59 = choose (B84 IF (A55 <> SPACES), -
%*                SPACES)
%*  A58 = choose ('Phone Number ' IF (A59 <> SPACES), -
%*                ' ')
%*  A64 = choose (B87 IF (A37 = 'WH'), -
%*                SPACES)
    B44 = PRINTER                    VIA (C37)
%*DD    B44 = PRINTER (PRINTDD)
    B45 = catenate (C37 ,C38)
    B51 = choose (%DEFPRIN% IF (%DEFPRIN% <> SPACES), -
                  B45 IF (B45 <> SPACES AND NO-PRINT-IND = 'R'), -
                  B44 IF (C36 <> SPACES), -
                  B50 IF (B50 <> SPACES AND NO-PRINT-IND = 'R'), -
                  B49 IF (B49 <> SPACES AND (A37 = 'RC' OR A37 = 'TL')), -
                  B47 IF (B47 <> SPACES AND A37 <> 'NI' AND A37 <> 'NS' AND -
                          A37 <> 'TI' AND A37 <> 'CR' AND A37 <> 'TC' AND A15 <> 'S'), -
                  B48 IF (B48 <> SPACES AND B91 > 10), -
                  B46)
%*
%*  JKB 2 lines
%*  B00 = choose (C30 IF (A98 = 'S'), -
%*                B29)
    B52 = PRINTER (B51)
%*DD    B52 = PRINTER (PRINTDD)
%*  JKB 8 lines
%*  B22 = choose (0 IF (A13 = 'Y'), -
%*                1)
%*  B23 = TOTAL (B22)
%*  B07 = choose (C32 IF (A98 = 'S'), -
%*                B30)
%*  B10 = PUT (C33) MAX (18)
%*  A21 = choose (B54 IF (B55 = SPACES), -
%*                B55)
    C29 = REC-BIN-CODE-3 OF MSS190 -
          WHERE (OPTION-190     = 'P', -
                 WHOUSE-ID      = DSTRCT-CODE, -
                 STOCK-CODE     = STOCK-CODE, -
                 QTY-REQ        = QTY-REQ, -
                 USE-UP-TO-DATE = B34, -
                 CAT-MATCH-VAL  = B35)
%*
%*  JKB 1 lines
%*  C28 = REC-BIN-CODE-2             VIA (C29)
    C05 = REC-BIN-CODE-1             VIA (C29)
%*  JKB 2 lines
%*  A85 = choose (C28 IF (C04 = 'Y' AND C05 <> SPACES), -
%*                SPACES)
    B39 = choose (C05 IF (C04 = 'Y' AND C05 <> SPACES), -
                  B38)
%*  JKB 2 lines
%*  A86 = choose (C29 IF (C04 = 'Y' AND C05 <> SPACES), -
%*                SPACES)
    C10 = RET-BATCH-LOT-NO OF MSS1HD -
    WHERE (OPTION-1HD             = 'R', -
           DSTRCT-CODE            = DSTRCT-CODE, -
           WHOUSE-ID              = WHOUSE-ID, -
           STOCK-CODE             = STOCK-CODE)

    BY-DAT = USE-BY-DATE-R VIA (C10)

%*
%*  JKB 1 lines
    C11    = SINGLE (BY-DAT (3 ))
    C27    = SINGLE (BY-DAT (11 ))
    C26    = SINGLE (C10 (11 ))
    C07    = SINGLE (BY-DAT (1 ))
    C06    = SINGLE (C10 (1 ))

%*  JKB 1 lines
    C08 = SINGLE (C10 (2 ))
    C09 = SINGLE (BY-DAT (2 ))
    C12 = SINGLE (C10 (4 ))
    C16 = SINGLE (C10 (6 ))
    C17 = SINGLE (BY-DAT (6 ))
    C18 = SINGLE (C10 (7 ))
    C13 = SINGLE (BY-DAT (4 ))
    C15 = SINGLE (BY-DAT (5 ))
    C14 = SINGLE (C10 (5 ))
    C25 = SINGLE (BY-DAT (10 ))
    C23 = SINGLE (BY-DAT (9 ))
    C24 = SINGLE (C10 (10 ))
    C19 = SINGLE (BY-DAT (7 ))
    C20 = SINGLE (C10 (8 ))
    C22 = SINGLE (C10 (9 ))
    C21 = SINGLE (BY-DAT (8 ))
    A84 = choose ('---SHELF LIFE DETAILS---' IF ((C06 <> SPACES OR C07 <> SPACES) OR -
                                                 (C08 <> SPACES OR C09 <> SPACES) OR -
                                                 (C10 <> SPACES OR C11 <> SPACES) OR -
                                                 (C12 <> SPACES OR C13 <> SPACES) OR -
                                                 (C14 <> SPACES OR C15 <> SPACES) OR -
                                                 (C16 <> SPACES OR C17 <> SPACES) OR -
                                                 (C18 <> SPACES OR C19 <> SPACES) OR -
                                                 (C20 <> SPACES OR C21 <> SPACES) OR -
                                                 (C22 <> SPACES OR C23 <> SPACES) OR -
                                                 (C24 <> SPACES OR C25 <> SPACES) OR -
                                                 (C26 <> SPACES OR C27 <> SPACES)), -
                  SPACES)
    A83 = choose (C05 IF (C04 = 'Y' AND C05 <> SPACES), -
                  B38 IF (B38 <> SPACES AND A84 <> SPACES), -
                  SPACES)
%*  JKB 6 lines            
%*  A82 = choose ('Optimal Bin Location' IF (C04 = 'Y' AND A83 <> SPACES), -
%*                'Primary Bin Location' IF (B38 <> SPACES AND A84 <> SPACES), -
%*                SPACES)
%*  A88 = choose ('Use By Date' IF (A84 <> SPACES), -
%*                SPACES)
%*  A87 = choose ('Batch Lot' IF (A84 <> SPACES), -
%*                SPACES)
    B13 = ASSOC-CHAR-1 FROM MSF010 -
          WHERE (TABLE-TYPE  = 'CS', -
                 TABLE-CODE >= SPACES)
%*  JKB 3 lines            
%*  C34 = TABLE-CODE                 VIA (B13)
%*  B18 = ASSOC-CHAR-11              VIA (B13)
%*  B14 = substr (C34, 1, 2)
%*  JKB 12 lines            
%*  B19 = get (READ-TEXT FROM ('MSF096') -
%*             CODE ('CS') -
%*             TYPE (B14) -
%*             STOCK-CODE-VALUE (STOCK-CODE)) -
%*        MAX (20) TEXT-WIDTH (60)
%*  B20 = size (B19)
%*  B15 = get (READ-TEXT FROM ('MSF096') -
%*             CODE ('CS') TYPE (B14) -
%*             STOCK-CODE-VALUE (STOCK-CODE) -
%*             DISTRICT-VALUE (ISS-DSTRCT-CDE)) -
%*        MAX (20) TEXT-WIDTH (60)
%*  B16 = size (B15)
%*DD0799
     DCOM = get (READ-TEXT FROM ('MSF096') -
                 CODE ('CS') -
                 TYPE ('PC') -
                 DISTRICT-VALUE (DSTRCT-CODE) -
                 STOCK-CODE-VALUE (STOCK-CODE)) -
            MAX (100)
%*
     DCOM1 = get (READ-TEXT FROM ('MSF096') -
                  CODE ('CS') -
                  TYPE ('PS') -
                  DISTRICT-VALUE (DSTRCT-CODE) -
                  STOCK-CODE-VALUE (STOCK-CODE)) -
             MAX (100)
     DCOMS = size (DCOM)
    DCOM1S = size (DCOM1)
      GCOM = get (READ-TEXT FROM ('MSF096') -
                  CODE ('CS') -
                  TYPE ('PC') -
                  STOCK-CODE-VALUE (STOCK-CODE)) -
             MAX (100)
%*
     GCOM1 = get (READ-TEXT FROM ('MSF096') -
                  CODE ('CS') -
                  TYPE ('PS') -
                  STOCK-CODE-VALUE (STOCK-CODE)) -
             MAX (100)
     GCOMS = size (GCOM)
    GCOM1S = size (GCOM1)
%*DD0799
      U    = WHOUSE-ID
      V1   = PART-ISSUE 
      V    = choose (V1 IF (V1 <> SPACES), -
                     'Y')
      XREF = ACTV-SUB-IND
    PINSTR = get (READ-TEXT FROM ('MSF096') -
                  CODE ('PS') -
                  KEY (%DISTRICT-CODE%, IREQ-NO)) -
             MAX (100)
    PINSTR1 = get (READ-TEXT FROM ('MSF096') -
                   CODE ('NT') -
                   KEY ('AL',B90)) -
              MAX (1)
    PINSTR2 = get (READ-TEXT FROM ('MSF096') -
                   CODE ('NT') -
                   KEY ('1',B90,B92)) -
              MAX (100)
%*
    DESC1 = DESC-LINE-1              VIA (A78) 
    DESC2 = DESC-LINE-2              VIA (A78) 
    DESC3 = DESC-LINE-3              VIA (A78) 
    DESC4 = DESC-LINE-4              VIA (A78)

%*     QR = (ORIGINAL) Quanity Required
       QR = QTY-REQ
%*
%*     Z1 = Total quantity pre-posted and/or manually acquitted
       Z1 = CALC (QTY-ISSUED + QTY-ISSUED-CON)
%*     (MSF141-QTY-REACTIV holds the current Qty Pre-posted/Acquitted)
%*     calculate the 'required Qty' for the picking Slip
       Q  = CALC (QR - Z1)
%*      QLESS1 represents the no. of repetitions for Component Tracing
       QX = CALC (Q - 1)
       QREV   = CALC (Q * -1 - 1)
       QLESS1 = choose (QX IF (Q > 0), -
                        QREV IF (Q < 0), -
                        0)
%*
       LQP    = choose (' Qty Picked' IF (C49 = 'N'), -
                        'Qty to Pick')
       LQA    = choose ('          ' IF (C49 = 'A'), -
                        '/To Acquit')
%*    available = SOH + (Qty-Issued + Qty-Issued-Con)  
%*EF   SOH = CALC (SOHA + Q)
       SOH = CALC (SOHA + Z1)            
       SOHN = CALC (SOH * 1) I-PIC (S9(5))  
%*
%*     now calculate Qty Picked/Qty to Pick:
       Z2  = CALC (SOHA + Q)
       Z2A = choose (Z2 IF (Z2 < Q), -
                     Q)
%*       Z3  = choose (Q IF ((B >= 'C0' AND B <= 'C9')  - 
%*                                   OR  (B >= 'CA' AND B <= 'CZ')), -
%*                           0 IF (Z2A < 0), Z2A)
%* DG  Z3 Should be 0 if avail < qty-req & part iss = n 
       Z3  = choose (Q IF ((B >= 'C0' AND B <= 'C9') OR - 
                           (B >= 'CA' AND B <= 'CZ')), -
                     0 IF (Z2A < 0), -
                     0 IF (SOHA < Q AND V = 'N'), -
                     Z2A)
       Z4  = choose (Z3 IF (QTY-REACTIV = 0), -
                     QTY-REACTIV)
%*
%* DG z3 if prepost = n or item is an xfer (NOT 0).
%* Qty to Pick
       Z   = choose (Z4 IF (C49 = 'Y'), -
                     Z3 IF (C49 = 'N' OR B662 = 'D'), -
                     QTY-REACTIV)    FORMAT (BWZ)
%*     and calculate Qty to Acquit
       QA1 = choose (Z3 IF (QTY-REACTIV = 0), 0)
%* DG QA = 0 if item is complete (for reprints).
%* Qty to Acquit
       QA  = choose (0 IF (ITEM-141-STAT = '9'), -
                     QA1 IF (C49 = 'Y'), -
                     Z3 IF (C49 = 'N'), -
                     0)              FORMAT (BWZ)
%*
 STATUS = choose ('OUTSIDE L/TIME' IF (ITEM-141-STAT = '0'), -
 'INSIDE L/TIME'  IF (ITEM-141-STAT = '1'), -
%* SC1136825 inserted SOH > 0 in the next line
 'WHSE SERVICING **MUST BE ACQUITTED**' IF (ITEM-141-STAT = '2', SOHN > 0), -
%* SC1838259 inserted SOH > 0 in the next line for status 3
 'WHSE SERVICING **MUST BE ACQUITTED**' IF (ITEM-141-STAT = '3', SOHN > 0), -
 'COMPLETE' IF (ITEM-141-STAT = '9'), -
 'STK UNAVAILABLE **NEED NOT ACQUIT**' IF (ITEM-141-STAT = '3'), -
 'STK UNAVAILABLE **NEED NOT ACQUIT**' IF(ITEM-141-STAT = '2', SOHN < 1), -
 'CREDIT ISSUE **GOODS RETURNED**' IF(ITEM-141-STAT= '4'), -
 'UNKNOWN STATUS???????')
%*
       TNDESC = TABLE-DESC OF MSF010 -
                WHERE (TABLE-TYPE = 'TN', -
                       TABLE-CODE = B3)
%*
    A08 = CHOOSE(%REQ-ITEM-FROM%  IF (%REQ-ITEM-TO% = SPACES OR %REQ-ITEM-TO% = '0000' ) , %REQ-ITEM-TO% ) CONSTANT
    SC        = CLASS                 VIA (B40)
    TC        = TABLE-CODE FROM MSF010       -
                WHERE (TABLE-TYPE  = '+MSL', -
                       TABLE-CODE >= SPACES) -
                SELECTIF (TABLE-CODE = SC)
    MSL       = MIN-STOCK-LVL         VIA (B41)
    SEL       = choose ('Y' IF (SC = TC AND SC <> SPACES), 'N')
    SOMINQ    = CALC (SO - QTY-REQ)
    SEL4      = choose ('Y' IF (SOMINQ < MSL), 'N')
    CNT       = choose ( 1 IF(B2 <> SPACES),0)
    CNT2      = total(CNT)
    WO        = WORK-ORDER OF MSF232 -
                WHERE (DSTRCT-CODE = %REQ-DSTRCT%, -
                       REQ-232-TYPE = 'I', -
                       REQUISITION-NO = %REQ-NO% & '  0000', -
                       ALLOC-COUNT >= SPACES) -
                MAX (1)
    WOT       = WO-TYPE OF MSF620 -
                WHERE (DSTRCT-CODE = %REQ-DSTRCT%, -
                       WORK-ORDER = WO)
    SEL2      = choose ('Y' IF (B661 = 'IP' OR B661 = 'CP'), 'N')
    SEL3      = choose ('Y' IF (WOT = 'CA'), 'N')
%* ---------------  End  of  the  Program  -----------------
