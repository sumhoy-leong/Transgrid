%*** TRZ110.RDL
%***
%**  Copyright (c) 1997, Mincom Pty Ltd, Brisbane 4120, Australia.
%*** All rights reserved.
%***
%*** Revision History ***
%*** 27-Jul-12 a9nh4814     MO164 (Version 0001)
%*** .....................  Refined report to pass Transgrid RDL compiler.
%*** .....................  Reset to version 0001 for Ellipse 8 migration.
%*** 02-Dec-98 DDiolaso     Recompile (Fix for MIMS 4.3)
%*** 15-Apr-98 EFredeluces  W804060032
%*** .....................  To include the employee surname and initials.
%*** 13-Feb-97 Matthews     Added date defaults
%*** 12-Feb-97 Autogen      Initial Coding.
%*** .....................  Generated by Version 001D of GENAUDIT.MAC.
%***
%PROGRAM-ID
       TRZ110
%AUTHOR
       Mincom PTY LTD
%NARRATIVE
      **  This program produces the audit records for MSF110
%VERSION
       0001
%MODULE
       3001
%FILES
        MFILE = MSF034
        LFILE = MSF810
        RFILE = TRZ110A
%ROUTINES
       MSSDAT
       MSSCNV
%SELECTION
       WHERE    (DATE-GMT >= %IFRDTE%)
       STOPIF   (%ITODTE% <> SPACES, -
                 DATE-GMT  > %ITODTE%)
%AUDITING-DATASETS
       MSF110
%REQUEST-PARAMETERS
       IMODF    PIC (X(1))    TEXT 'Modified fields only   : '
       IFRDTE   PIC (X(8))    TEXT 'From date              : '
       ITODTE   PIC (X(8))    TEXT 'To date                : '
       ITYP     PIC (X(1))    TEXT 'Modify type a/c/m/d    : '
       IUSER    PIC (X(10))   TEXT 'User id                : '
%REPORT-TITLE
'AUDIT TRAIL REPORT - PART NO./STOCK CODE CROSS REFERENCE FILE (MSF110)'
%PAGE HEADING
'TYPE     KEY                                            DATE       TIME    USER ID     EMPLOYEE NAME                    PROGRAM'
%DETAIL TEST-PAGE(14)
<IF CTYP = 'Y' AND CUSR = 'Y' AND CDTE = 'Y'>
   <IF KEYB1 = SPACES>

{ATYP   } {KEYA1     }                                 {ADTE    } {ATIM  }  {AUSER   }  {ENAME                         } {APROG }
   <ELSE>

{ATYP   } {KEYB1     }                                 {ADTE    } {ATIM  }  {AUSER   }  {ENAME                         } {APROG }
   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C11 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN1         } {FD1                    } {F1B1                          }
                                                   {F1A1                          }
         <ELSE>
          {FN1         } {FD1                    } {F1Z1                          }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN1         } {FD1                    } {F1B1                          }
                                                   {F1A1                          }
      <ELSE>
          {FN1         } {FD1                    } {F1Z1                          }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C21 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN2         } {FD2                    } {F2B1    }
                                                   {F2A1    }
         <ELSE>
          {FN2         } {FD2                    } {F2Z1    }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN2         } {FD2                    } {F2B1    }
                                                   {F2A1    }
      <ELSE>
          {FN2         } {FD2                    } {F2Z1    }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C31 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN3         } {FD3                    } {F3B1  }
                                                   {F3A1  }
         <ELSE>
          {FN3         } {FD3                    } {F3Z1  }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN3         } {FD3                    } {F3B1  }
                                                   {F3A1  }
      <ELSE>
          {FN3         } {FD3                    } {F3Z1  }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C41 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN4         } {FD4                    } {F4B1     }
                                                   {F4A1     }
         <ELSE>
          {FN4         } {FD4                    } {F4Z1     }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN4         } {FD4                    } {F4B1     }
                                                   {F4A1     }
      <ELSE>
          {FN4         } {FD4                    } {F4Z1     }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C51 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN5         } {FD5                    } {F5B1  }
                                                   {F5A1  }
         <ELSE>
          {FN5         } {FD5                    } {F5Z1  }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN5         } {FD5                    } {F5B1  }
                                                   {F5A1  }
      <ELSE>
          {FN5         } {FD5                    } {F5Z1  }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C61 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN6         } {FD6                    } {F6B1                          }
                                                   {F6A1                          }
         <ELSE>
          {FN6         } {FD6                    } {F6Z1                          }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN6         } {FD6                    } {F6B1                          }
                                                   {F6A1                          }
      <ELSE>
          {FN6         } {FD6                    } {F6Z1                          }
      <ENDIF>

   <ENDIF>
   <IF %IMODF% = 'Y'>
      <IF C71 = 'Y'>
         <IF ATYP = 'Modify'>
          {FN7         } {FD7                    } {F7B1  }
                                                   {F7A1  }
         <ELSE>
          {FN7         } {FD7                    } {F7Z1  }
         <ENDIF>

      <ENDIF>
   <ELSE>
      <IF ATYP = 'Modify'>
          {FN7         } {FD7                    } {F7B1  }
                                                   {F7A1  }
      <ELSE>
          {FN7         } {FD7                    } {F7Z1  }
      <ENDIF>

   <ENDIF>
<ENDIF>
%REPORT-SUMMARY



                                                 '*** END OF REPORT ***'

%VARIABLES
      XDAT  = WX-TODAYS-DATE
%* get yesterday
      YDATT = DATE2 of MSSDAT -
               WHERE (OPTION    =  '1',   -
                      DATE1     =  XDAT,  -
                      DAYS      = -1)
%*
%* setup if date range to default
      CDATT = CHOOSE (YDATT IF (%ITODTE% = '        '), -
                      YDATT IF (%ITODTE% = '00000000'), -
                      %ITODTE%) I-PIC (9(8))
      CDATF = CHOOSE (YDATT IF (%IFRDTE% = '        '), -
                      YDATT IF (%IFRDTE% = '00000000'), -
                      %IFRDTE%) I-PIC (9(8))
%* set a variable if required
      CDTE  = CHOOSE ('Y' IF (DATE-GMT >= CDATF AND DATE-GMT <= CDATT), -
                      'N')
%* get employee name
       EMPF   = USER-ID
       EMP    = substr (EMPF,2,5)       D-PIC (X(5))
       EMPID  = catenate ('00000',EMP)  D-PIC (X(10))
       SNAME  = SURNAME OF MSF810 - 
                     WHERE (EMPLOYEE-ID = EMPID)
       FNAME  = FIRST-NAME  VIA (SNAME)
       NAME   = CATENATE (SNAME,' ',FNAME)
       ENAME  = OUT-STRING OF MSSCNV -
                     WHERE (OPTION     = 'P', -
                            INP-STRING = NAME)
       FN1    = 'PART-NO'                   CONSTANT
       FD1    = 'Manufacturer''s part numbe' CONSTANT
       FN2    = 'MNEMONIC'                  CONSTANT
       FD2    = 'Manufacturer''s mnemonic'   CONSTANT
       FN3    = 'DSTRCT-CODE'               CONSTANT
       FD3    = 'District identifier code'  CONSTANT
       FN4    = 'STOCK-CODE'                CONSTANT
       FD4    = 'Stock code'                CONSTANT
       FN5    = 'PREF-PART-IND'             CONSTANT
       FD5    = 'Part Number Preference In' CONSTANT
       FN6    = 'PACKED-PART-NO'            CONSTANT
       FD6    = 'Part no. with spaces stri' CONSTANT
       FN7    = 'STATUS-CODES'              CONSTANT
       FD7    = 'Group item for Part Statu' CONSTANT
       AUD    = AUDIT-TYPE
       CTYP   = CHOOSE ('Y' IF (%ITYP% = SPACES), -
                        'Y' IF (%ITYP% = 'A'), -
                        'Y' IF (%ITYP% = 'C', AUD = 'W'), -
                        'Y' IF (%ITYP% = 'D', AUD = 'D'), -
                        'Y' IF (%ITYP% = 'M', AUD = 'A'), -
                        'Y' IF (%ITYP% = 'M', AUD = 'B'), -
                        'N')
       CUSR   = CHOOSE ('Y' IF (%IUSER% = SPACES), -
                        'Y' IF (%IUSER% = USER-ID), -
                        'N')
       ADTE   = DATE-GMT FORMAT (DATE)
       ATIM   = TIME-GMT FORMAT (TIME)
       AUSER  = USER-ID
       APROG  = PROGRAM-NAME
       ATYP   = CHOOSE ('Create' IF (AUD = 'W'), -
                        'Delete' IF (AUD = 'D'), -
                        'Modify')
       KEYB1 = BEFORE-VALUE (MSF110, KEY-110)
       KEYA1 = AFTER-VALUE (MSF110, KEY-110)

       C11    = CHANGED (MSF110, PART-NO)
       F1B1   = BEFORE-VALUE (MSF110, PART-NO)
       F1A1   = AFTER-VALUE (MSF110, PART-NO)
       F1Z1   = CHOOSE (F1B1 IF (ATYP = 'Delete'), -
                        F1A1 IF (ATYP = 'Create'), -
                        SPACES)

       C21    = CHANGED (MSF110, MNEMONIC)
       F2B1   = BEFORE-VALUE (MSF110, MNEMONIC)
       F2A1   = AFTER-VALUE (MSF110, MNEMONIC)
       F2Z1   = CHOOSE (F2B1 IF (ATYP = 'Delete'), -
                        F2A1 IF (ATYP = 'Create'), -
                        SPACES)

       C31    = CHANGED (MSF110, DSTRCT-CODE)
       F3B1   = BEFORE-VALUE (MSF110, DSTRCT-CODE)
       F3A1   = AFTER-VALUE (MSF110, DSTRCT-CODE)
       F3Z1   = CHOOSE (F3B1 IF (ATYP = 'Delete'), -
                        F3A1 IF (ATYP = 'Create'), -
                        SPACES)

       C41    = CHANGED (MSF110, STOCK-CODE)
       F4B1   = BEFORE-VALUE (MSF110, STOCK-CODE)
       F4A1   = AFTER-VALUE (MSF110, STOCK-CODE)
       F4Z1   = CHOOSE (F4B1 IF (ATYP = 'Delete'), -
                        F4A1 IF (ATYP = 'Create'), -
                        SPACES)

       C51    = CHANGED (MSF110, PREF-PART-IND)
       F5B1   = BEFORE-VALUE (MSF110, PREF-PART-IND)
       F5A1   = AFTER-VALUE (MSF110, PREF-PART-IND)
       F5Z1   = CHOOSE (F5B1 IF (ATYP = 'Delete'), -
                        F5A1 IF (ATYP = 'Create'), -
                        SPACES)

       C61    = CHANGED (MSF110, PACKED-PART-NO)
       F6B1   = BEFORE-VALUE (MSF110, PACKED-PART-NO)
       F6A1   = AFTER-VALUE (MSF110, PACKED-PART-NO)
       F6Z1   = CHOOSE (F6B1 IF (ATYP = 'Delete'), -
                        F6A1 IF (ATYP = 'Create'), -
                        SPACES)

       C71    = CHANGED (MSF110, STATUS-CODES)
       F7B1   = BEFORE-VALUE (MSF110, STATUS-CODES)
       F7A1   = AFTER-VALUE (MSF110, STATUS-CODES)
       F7Z1   = CHOOSE (F7B1 IF (ATYP = 'Delete'), -
                        F7A1 IF (ATYP = 'Create'), -
                        SPACES)
